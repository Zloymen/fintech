"use strict";!function(){angular.module("app",["ng","ngRoute","ngMaterial","ngMessages","ngAria","ngAnimate","ngCookies","ngSanitize","ngCookies","LocalStorageModule","md.data.table","ui.router","ui.mask","datetime","textAngular","ui.grid","ui.grid.pagination","ui.grid.selection","ui.grid.cellNav","ui.grid.grouping","ui.grid.autoResize","rzModule","ui-rangeSlider"]).config(["uiMask.ConfigProvider",function(e){e.maskDefinitions({K:/[a-zA-Z0-9]/,"*":/[a-zA-Z0-9]/}),e.clearOnBlur(!1)}]).config(["$mdDateLocaleProvider",function(e){e.firstDayOfWeek=1,e.formatDate=function(e){return moment(e).format("DD-MM-YYYY")},e.parseDate=function(e){return moment(e,"DD.MM.YYYY").toDate()}}])}(),function(){function e(e,t,n,o,a,r,i){n.applicationLoaded=!0,t.showToolbar=function(){return!e.includes("auth")},t.openMenu=function(e,t){e.open(t)},t.toggleSidenav=function(){a("sidenav-left").toggle()}}angular.module("app").controller("MainController",e),e.$inject=["$state","$scope","$rootScope","Prompt","$mdSidenav","$timeout","$mdDialog"]}(),function(){function e(e,t,n,o){t.html5Mode(!0),n.otherwise("/"),e.state("appui",{templateUrl:"/app/main.layout.html?1538469990541",controller:"MainController"}).state("appui.main",{url:"/",templateUrl:"/app/pages/main/present.html?1538469990541",controller:"PresentController",controllerAs:"presentCtrl"}).state("appui.buy",{url:"/buy",templateUrl:"/app/pages/step/step.html?1538469990541",controller:"StepController",controllerAs:"stepCtrl",resolve:{reservation:["$rootScope","ReservationManager",function(e,t){return t.get()}]}}).state("appui.info",{url:"/info",templateUrl:"/app/pages/info/info.html?1538469990541",controller:"InfoController",controllerAs:"infoCtrl",resolve:{catalogs:["$rootScope","OrderManager",function(e,t){return t.getCatalogs()}]}})}angular.module("app").config(e),e.$inject=["$stateProvider","$locationProvider","$urlRouterProvider"]}(),function(){function e(e){return{restrict:"A",link:function(t,n){var o=e.iOsSafari()?"safari-mobile":"browser";n.addClass(o)}}}angular.module("app").directive("browser",e),e.$inject=["Device"]}(),function(){function e(){return{restrict:"A",require:"ngModel",scope:{compareTo:"=compare"},link:function(e,t,n,o){o.$validators.notEqual=function(t,n){return!!o.$isEmpty(t)||n===e.compareTo.$viewValue},e.$watch("compareTo.$viewValue",function(){o.$validate()})}}}angular.module("app").directive("compare",e)}(),function(){angular.module("app").directive("strongPassRequired",function(){var e=function(e){return e&&/(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=\S+$).{6,}/.test(e)};return{require:"ngModel",link:function(t,n,o,a){a.$parsers.unshift(function(t){return a.$setValidity("strongPass",e(t)),t}),a.$formatters.unshift(function(t){return a.$setValidity("strongPass",e(t)),t})}}}).directive("passwordMatch",[function(){return{restrict:"A",scope:!0,require:"ngModel",link:function(e,t,n,o){var a=function(){var t=e.$eval(n.ngModel),a=e.$eval(n.passwordMatch);return o.$validators.check=function(e){return!o.$isEmpty(e)&&e===a},t===a};e.$watch(a,function(e){o.$setValidity("unique",e)})}}}])}(),function(){function e(){return{restrict:"A",link:function(e,t,n,o){$(t).click(function(e){e.stopImmediatePropagation(),e.preventDefault()})}}}angular.module("app").directive("preventClick",e)}(),function(){function e(e){return{restrict:"A",link:function(t,n){n.on("change",function(){e(function(){t.uploadCtrl.uploadData.file=n[0].files[0]},100)})}}}angular.module("app").directive("uploadFile",e),e.$inject=["$timeout"]}(),function(){function e(e){return function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",a={template:["<md-dialog>",'  <md-dialog-content class="md-dialog-content" role="document" tabIndex="-1">','    <h2 class="md-title" ng-bind-html="::dialog.title"></h2>','    <div ng-if="::dialog.mdHtmlContent" class="md-dialog-content-body"','        ng-bind-html="::dialog.htmlContent"></div>',"  </md-dialog-content>","  <md-dialog-actions>",'    <md-button ng-click="dialog.hide()" class="md-accent md-confirm-button" style="color: white;" md-autofocus="true">',"      {{ dialog.ok }}","    </md-button>","  </md-dialog-actions>","</md-dialog>"].join("").replace(/\s\s+/g,""),controllerAs:"dialog",multiple:!0,controller:["$mdDialog",function(e){var a=this,r=[t,n,o];a.title=r[0],a.htmlContent=r[1];var i=r[2];a.ok=void 0===i?o:i,a.hide=function(){e.hide()}}]};return e.show(a)}}angular.module("app").factory("Alert",e),e.$inject=["$mdDialog"]}(),function(){function e(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel";return e.show(e.confirm().title(t).textContent(n).ok(o).cancel(a))}}angular.module("app").factory("Confirm",e),e.$inject=["$mdDialog"]}(),function(){function e(e,t,n,o,a,r){function i(e){return e}function l(e){return console.log(e),[401,403].indexOf(e.status)>-1&&n.go("auth.login"),413===e.status&&r("Attachment is too large","Please choose another attachment or resize this one"),400===e.status&&r("Error",e.data.message||"Please try again"),401!==e.status&&402!==e.status&&403!==e.status||r("Unauthorized access",e.data.message||"Try to sign in again, please ..."),t.reject(e)}function c(n){var r=n.method,c=void 0===r?"get":r,s=n.url,d=void 0===s?"/":s,p=n.data,f=void 0===p?{}:p,g=n.headers,m=void 0===g?{}:g,h=n.transformRequest,v=void 0===h?null:h,$=n.triggerCircleLoader,y=void 0===$?{trigger:!1,message:null}:$;y.trigger&&o(function(){a.$broadcast("circleLoaderStart",{message:y.message})});var M={method:c,url:u+d,withCredentials:!0};return"get"===c.toLowerCase()||"delete"===c.toLocaleLowerCase()?M.params=f:M.data=f,v&&(M.transformRequest=v),0!==Object.keys(m).length&&(M.headers=m),e(M).then(i,l).then(function(e){return y.trigger&&o(function(){a.$broadcast("circleLoaderStop",{message:null})}),e},function(e){return y.trigger&&o(function(){a.$broadcast("circleLoaderStop",{message:null})}),t.reject(e)})}var u="";return{request:c}}angular.module("app").factory("HttpManager",e),e.$inject=["$http","$q","$state","$timeout","$rootScope","Alert"]}(),function(){function e(e){function t(){return e.request({method:"GET",url:"/order/catalogs"})}function n(t,n,o){return e.request({method:"GET",url:"/order/report",data:{filmId:t.id,day:moment(n).format("DD.MM.YYYY"),sessionId:o}})}function o(){return e.request({method:"POST",url:"/order/"})}return{report:n,getCatalogs:t,buy:o}}angular.module("app").factory("OrderManager",e),e.$inject=["HttpManager"]}(),function(){function e(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Ok",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Cancel";return e.show(e.prompt().title(t).textContent(n).placeholder(o).required(!0).ok(a).cancel(r))}}angular.module("app").factory("Prompt",e),e.$inject=["$mdDialog"]}(),function(){function e(e){function t(){return e.request({method:"GET",url:"/reservation/"})}function n(t,n,o){return e.request({method:"GET",url:"/reservation/usedPlaces",data:{filmId:t.id,day:moment(n).format("DD.MM.YYYY"),sessionId:o}})}function o(){return e.request({method:"POST",url:"/reservation/delete"})}function a(t){var n=angular.copy(t);return n.day=moment(n.day).format("DD.MM.YYYY"),n.film=n.film.id,e.request({method:"POST",url:"/reservation/",data:n})}return{getUsedPlace:n,get:t,cancel:o,save:a}}angular.module("app").factory("ReservationManager",e),e.$inject=["HttpManager"]}(),function(){angular.module("app").component("captcha",{templateUrl:"./app/components/captcha/captcha.html"})}(),function(){function e(e,t,n){function o(){a.captchaUrl=a.captchaUrlSrc+"?"+(new Date).getTime()}var a=this;a.captchaUrlSrc="/api/v1/captcha.gif",a.captchaUrl=a.captchaUrlSrc,a.updateCaptcha=o}angular.module("app").controller("CaptchaController",e),e.$inject=["$state","$rootScope","$stateParams"]}(),function(){angular.module("app").component("logo",{templateUrl:"./app/components/logo/logo.html"})}(),function(){function e(e,t,n,o,a,r){function i(e,t){var n=angular.lowercase(e);return function(e){return 0===angular.lowercase(e[t]).indexOf(n)}}a&&a.data&&(e.catalogs=a.data),e.find=function(){e.film&&e.session&&e.day&&r.report(e.film,e.day,e.session).then(function(t){e.gridOptions.data=t.data})},e.gridOptions={columnDefs:[{name:"Место",field:"place.name",enableSorting:!1},{name:"Телефон",field:"phone",enableSorting:!1},{name:"Тип",field:"type",enableSorting:!1}],data:[]},e.main=function(){n.go("appui.main")},e.onChange=function(e){},e.clear=function(){e.film=null,e.session=null,e.day=new Date,e.gridOptions.data=[]},e.clear(),e.query=function(t){return t?e.catalogs.films.filter(i(t,"name")):e.catalogs.films}}angular.module("app").controller("InfoController",e),e.$inject=["$scope","$log","$state","$timeout","catalogs","OrderManager"]}(),function(){function e(e,t,n,o){e.buy=function(){n.go("appui.buy")},e.info=function(){n.go("appui.info")}}angular.module("app").controller("PresentController",e),e.$inject=["$scope","$log","$state","$timeout"]}(),function(){function e(e,t,n,o,a,r,i,l){function c(e,t){var n=angular.lowercase(e);return function(e){return 0===angular.lowercase(e[t]).indexOf(n)}}function u(t){t.data?(e.errMsg=t.data.message,e.uid=t.data.uuid):(e.errMsg="Неизвестная ошибка!",e.uid=null),e.step=0}e.reservation={film:{id:12,name:"Temporary Difficulties"},phone:"11111",day:new Date,session:"3",places:[]},e.toggle=function(e,t){var n=t.indexOf(e);n>-1?t.splice(n,1):t.push(e)},e.exists=function(e,t){return t.indexOf(e)>-1},e.step=1,e.errMsg="",e.search="",e.$watch("reservation",function(){e.reservation.film&&e.reservation.day&&e.reservation.session&&i.getUsedPlace(e.reservation.film,e.reservation.day,e.reservation.session).then(function(t){console.log(t.data),e.catalogs.places.forEach(function(e){e.disable=t.data.some(function(t){return t.id===e.id})}),console.log(e.catalogs.places)})},!0),e.onChange=function(e){},e.query=function(t){return t?e.catalogs.films.filter(c(t,"name")):e.catalogs.films},e.catalogs={},r.getCatalogs().then(function(t){try{e.catalogs=t.data}catch(n){u(n)}},function(e){u(e)}),e.stepSrc=function(){return e.step>0?"/app/pages/step/step"+e.step+".html":"/app/pages/step/stepError.html"},e.cancel=function(){i.cancel().then(function(){t.go("appui.main")},function(e){u(e)})},e.pay=function(){r.buy().then(function(t){e.step=3},function(e){u(e)})},e.reserved=function(){i.save(e.reservation).then(function(e){s(e.data)},function(e){u(e)})},e.savedReservation=null;var s=function(t){e.step=2,e.savedReservation=t,e.savedReservation.strPlaces=e.savedReservation.places.map(function(e){return e.name}).join()};l&&l.status&&200===l.status&&s(l.data),e.main=function(){t.go("appui.main")}}angular.module("app").controller("StepController",e),e.$inject=["$scope","$state","$rootScope","Alert","$timeout","OrderManager","ReservationManager","reservation"]}(),function(){function e(){return{restrict:"E",templateUrl:"shared/application-loader/application-loader.html"}}angular.module("app").directive("applicationLoader",e)}(),function(){function e(){return{restrict:"E",replace:!0,templateUrl:"./app/shared/circle-loader/circle-loader.html",controller:["$scope","$timeout","$interval",function(e,t,n){angular.element(document.body);e.circleLoaderMessage=null,e.showCircleLoader=!1,e.$on("circleLoaderStart",function(t,n){e.circleLoaderMessage=n.message,e.showCircleLoader=!0}),e.$on("circleLoaderStop",function(){e.showCircleLoader=!1,t(function(){e.circleLoaderMessage=null},400)})}]}}angular.module("app").directive("circleLoader",e)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN1c3RvbS5qcyIsImFwcC5qcyIsIm1haW4uY29udHJvbGxlci5qcyIsImNvbmZpZy9yb3V0ZXIuY29uZmlnLmpzIiwiZGlyZWN0aXZlcy9icm93c2VyLmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvY29tcGFyZS5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL3Bhc3N3b3JkLmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvcHJldmVudGNsaWNrLmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvdXBsb2FkRmlsZS5kaXJlY3RpdmUuanMiLCJzZXJ2aWNlcy9hbGVydC5mYWN0b3J5LmpzIiwic2VydmljZXMvY29uZmlybS5mYWN0b3J5LmpzIiwic2VydmljZXMvaHR0cC5tYW5hZ2VyLmpzIiwic2VydmljZXMvb3JkZXIubWFuYWdlci5qcyIsInNlcnZpY2VzL3Byb21wdC5mYWN0b3J5LmpzIiwic2VydmljZXMvcmVzZXJ2YXRpb24ubWFuYWdlci5qcyIsImNvbXBvbmVudHMvY2FwdGNoYS9jYXB0Y2hhLmNvbXBvbmVudC5qcyIsImNvbXBvbmVudHMvY2FwdGNoYS9jYXB0Y2hhLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL2xvZ28vbG9nby5jb21wb25lbnQuanMiLCJwYWdlcy9pbmZvL2luZm8uY29udHJvbGxlci5qcyIsInBhZ2VzL21haW4vcHJlc2VudC5jb250cm9sbGVyLmpzIiwicGFnZXMvc3RlcC9zdGVwLmNvbnRyb2xsZXIuanMiLCJzaGFyZWQvYXBwbGljYXRpb24tbG9hZGVyL2FwcGxpY2F0aW9uTG9hZGVyLmNvbXBvbmVudC5qcyIsInNoYXJlZC9jaXJjbGUtbG9hZGVyL2NpcmNsZS1sb2FkZXIuZGlyZWN0aXZlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCJ1aU1hc2tDb25maWdQcm92aWRlciIsIm1hc2tEZWZpbml0aW9ucyIsIksiLCIqIiwiY2xlYXJPbkJsdXIiLCIkbWREYXRlTG9jYWxlUHJvdmlkZXIiLCJmaXJzdERheU9mV2VlayIsImZvcm1hdERhdGUiLCJkYXRlIiwibW9tZW50IiwiZm9ybWF0IiwicGFyc2VEYXRlIiwic3RyRGF0ZSIsInRvRGF0ZSIsIk1haW5Db250cm9sbGVyIiwiJHN0YXRlIiwiJHNjb3BlIiwiJHJvb3RTY29wZSIsIlByb21wdCIsIiRtZFNpZGVuYXYiLCIkdGltZW91dCIsIiRtZERpYWxvZyIsImFwcGxpY2F0aW9uTG9hZGVkIiwic2hvd1Rvb2xiYXIiLCJpbmNsdWRlcyIsIm9wZW5NZW51IiwiJG1kTWVudSIsImV2Iiwib3BlbiIsInRvZ2dsZVNpZGVuYXYiLCJ0b2dnbGUiLCJjb250cm9sbGVyIiwiJGluamVjdCIsInJvdXRlciIsIiRzdGF0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJSZXNlcnZhdGlvbk1hbmFnZXIiLCJodG1sNU1vZGUiLCJvdGhlcndpc2UiLCJzdGF0ZSIsInRlbXBsYXRlVXJsIiwidXJsIiwiY29udHJvbGxlckFzIiwicmVzb2x2ZSIsInJlc2VydmF0aW9uIiwiZ2V0IiwiY2F0YWxvZ3MiLCJPcmRlck1hbmFnZXIiLCJnZXRDYXRhbG9ncyIsImJyb3dzZXIiLCJEZXZpY2UiLCJyZXN0cmljdCIsImxpbmsiLCJzY29wZSIsImVsZW0iLCJpT3NTYWZhcmkiLCJhZGRDbGFzcyIsImRpcmVjdGl2ZSIsImNvbXBhcmUiLCJyZXF1aXJlIiwiY29tcGFyZVRvIiwiYXR0cnMiLCJuZ01vZGVsIiwiJHZhbGlkYXRvcnMiLCJub3RFcXVhbCIsIm1vZGVsVmFsdWUiLCJ2aWV3VmFsdWUiLCIkaXNFbXB0eSIsIiR2aWV3VmFsdWUiLCIkd2F0Y2giLCIkdmFsaWRhdGUiLCJpc1ZhbGlkIiwicyIsInRlc3QiLCJlbG0iLCJuZ01vZGVsQ3RybCIsIiRwYXJzZXJzIiwidW5zaGlmdCIsIiRzZXRWYWxpZGl0eSIsIiRmb3JtYXR0ZXJzIiwiY29udHJvbCIsImNoZWNrZXIiLCJlMSIsIiRldmFsIiwiZTIiLCJwYXNzd29yZE1hdGNoIiwiY2hlY2siLCJuIiwicHJldmVudENsaWNrIiwiZWxlbWVudCIsIiQiLCJjbGljayIsImV2ZW50Iiwic3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIiwicHJldmVudERlZmF1bHQiLCJ1cGxvYWRGaWxlIiwib24iLCJ1cGxvYWRDdHJsIiwidXBsb2FkRGF0YSIsImZpbGUiLCJmaWxlcyIsIkFsZXJ0IiwidGl0bGUiLCJodG1sQ29udGVudCIsIm9rIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiYWxlcnQiLCJ0ZW1wbGF0ZSIsImpvaW4iLCJyZXBsYWNlIiwibXVsdGlwbGUiLCJkaWFsb2ciLCJ0aGlzIiwiX3JlZiIsIl9yZWYkIiwiaGlkZSIsInNob3ciLCJmYWN0b3J5IiwiQ29uZmlybSIsInRleHRDb250ZW50IiwiY2FuY2VsIiwiY29uZmlybSIsIkh0dHBNYW5hZ2VyIiwiJGh0dHAiLCIkcSIsIm9uU3VjY2VzcyIsInJlc3BvbnNlIiwib25FcnJvciIsInJlamVjdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJpbmRleE9mIiwic3RhdHVzIiwiZ28iLCJkYXRhIiwibWVzc2FnZSIsInJlamVjdCIsInJlcXVlc3QiLCJfcmVmJG1ldGhvZCIsIm1ldGhvZCIsIl9yZWYkdXJsIiwiX3JlZiRkYXRhIiwiX3JlZiRoZWFkZXJzIiwiaGVhZGVycyIsIl9yZWYkdHJhbnNmb3JtUmVxdWVzdCIsInRyYW5zZm9ybVJlcXVlc3QiLCJfcmVmJHRyaWdnZXJDaXJjbGVMb2EiLCJ0cmlnZ2VyQ2lyY2xlTG9hZGVyIiwidHJpZ2dlciIsIiRicm9hZGNhc3QiLCJyZXF1ZXN0T2JqZWN0IiwiQVBJIiwid2l0aENyZWRlbnRpYWxzIiwidG9Mb3dlckNhc2UiLCJ0b0xvY2FsZUxvd2VyQ2FzZSIsInBhcmFtcyIsIk9iamVjdCIsImtleXMiLCJ0aGVuIiwicmVwb3J0IiwiZmlsbSIsImRheSIsInNlc3Npb24iLCJmaWxtSWQiLCJpZCIsInNlc3Npb25JZCIsImJ1eSIsInBsYWNlaG9sZGVyIiwicHJvbXB0IiwicmVxdWlyZWQiLCJnZXRVc2VkUGxhY2UiLCJzYXZlIiwicmVzZXJ2YXRpb25Db3B5IiwiY29weSIsImNvbXBvbmVudCIsIkNhcHRjaGFDb250cm9sbGVyIiwiJHN0YXRlUGFyYW1zIiwidXBkYXRlQ2FwdGNoYSIsImNhcHRjaGFDdHJsIiwiY2FwdGNoYVVybCIsImNhcHRjaGFVcmxTcmMiLCJEYXRlIiwiZ2V0VGltZSIsIkluZm9Db250cm9sbGVyIiwiJGxvZyIsImNyZWF0ZUZpbHRlckZvciIsInF1ZXJ5IiwibmFtZSIsImxvd2VyY2FzZVF1ZXJ5IiwibG93ZXJjYXNlIiwiaXRlbSIsImZpbmQiLCJyZXN1bHQiLCJncmlkT3B0aW9ucyIsImNvbHVtbkRlZnMiLCJmaWVsZCIsImVuYWJsZVNvcnRpbmciLCJtYWluIiwib25DaGFuZ2UiLCJzZWFyY2giLCJjbGVhciIsImZpbG1zIiwiZmlsdGVyIiwiUHJlc2VudENvbnRyb2xsZXIiLCJpbmZvIiwiU3RlcENvbnRyb2xsZXIiLCJlcnJvciIsImUiLCJlcnJNc2ciLCJ1aWQiLCJ1dWlkIiwic3RlcCIsInBob25lIiwicGxhY2VzIiwibGlzdCIsImlkeCIsInNwbGljZSIsInB1c2giLCJleGlzdHMiLCJmb3JFYWNoIiwiZGlzYWJsZSIsInNvbWUiLCJzdWJJdGVtIiwic3RlcFNyYyIsInBheSIsInJlc2VydmVkIiwic2V0UmVzZXJ2YXRpb24iLCJzYXZlZFJlc2VydmF0aW9uIiwiciIsInN0clBsYWNlcyIsIm1hcCIsImFwcGxpY2F0aW9uTG9hZGVyIiwiY2lyY2xlTG9hZGVyIiwiJGludGVydmFsIiwiZG9jdW1lbnQiLCJib2R5IiwiY2lyY2xlTG9hZGVyTWVzc2FnZSIsInNob3dDaXJjbGVMb2FkZXIiLCIkb24iXSwibWFwcGluZ3MiOiJBQUFBLGNDQUEsV0FDSUEsUUFBUUMsT0FBTyxPQUNYLEtBQ0EsVUFDQSxhQUNBLGFBQ0EsU0FDQSxZQUNBLFlBQ0EsYUFDQSxZQUNBLHFCQUNBLGdCQUNBLFlBQ0EsVUFDQSxXQUNBLGNBQ0EsVUFDQSxx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VXdOLEdBRXBEL08sUUFBUTZGLFFBQVFtSixTQUFTQyxLQUt0QzlOLEdBQU8rTixvQkFBc0IsS0FDN0IvTixFQUFPZ08sa0JBQW1CLEVBRTFCaE8sRUFBT2lPLElBQUksb0JBQXFCLFNBQUN0TixFQUFJOEcsR0FNbkN6SCxFQUFPK04sb0JBQXNCdEcsRUFBS0MsUUFDbEMxSCxFQUFPZ08sa0JBQW1CLElBRzVCaE8sRUFBT2lPLElBQUksbUJBQW9CLFdBQzdCak8sRUFBT2dPLGtCQUFtQixFQU8xQjVOLEVBQVMsV0FDUEosRUFBTytOLG9CQUFzQixNQUM1QixVQXRDWGxQLFFBQVFDLE9BQU8sT0FDWjRELFVBQVUsZUFBZ0JpTCIsImZpbGUiOiJjdXN0b20uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFsnbmcnLCAnbmdSb3V0ZScsICduZ01hdGVyaWFsJywgJ25nTWVzc2FnZXMnLCAnbmdBcmlhJywgJ25nQW5pbWF0ZScsICduZ0Nvb2tpZXMnLCAnbmdTYW5pdGl6ZScsICduZ0Nvb2tpZXMnLCAnTG9jYWxTdG9yYWdlTW9kdWxlJywgJ21kLmRhdGEudGFibGUnLCAndWkucm91dGVyJywgJ3VpLm1hc2snLCAnZGF0ZXRpbWUnLCAndGV4dEFuZ3VsYXInLCAndWkuZ3JpZCcsICd1aS5ncmlkLnBhZ2luYXRpb24nLCAndWkuZ3JpZC5zZWxlY3Rpb24nLCAndWkuZ3JpZC5jZWxsTmF2JywgJ3VpLmdyaWQuZ3JvdXBpbmcnLCAndWkuZ3JpZC5hdXRvUmVzaXplJywgJ3J6TW9kdWxlJywgJ3VpLXJhbmdlU2xpZGVyJ10pLmNvbmZpZyhbJ3VpTWFzay5Db25maWdQcm92aWRlcicsIGZ1bmN0aW9uICh1aU1hc2tDb25maWdQcm92aWRlcikge1xuICAgICAgICB1aU1hc2tDb25maWdQcm92aWRlci5tYXNrRGVmaW5pdGlvbnMoeyAnSyc6IC9bYS16QS1aMC05XS8sICcqJzogL1thLXpBLVowLTldLyB9KTtcbiAgICAgICAgdWlNYXNrQ29uZmlnUHJvdmlkZXIuY2xlYXJPbkJsdXIoZmFsc2UpO1xuICAgIH1dKS5jb25maWcoWyckbWREYXRlTG9jYWxlUHJvdmlkZXInLCBmdW5jdGlvbiAoJG1kRGF0ZUxvY2FsZVByb3ZpZGVyKSB7XG4gICAgICAgICRtZERhdGVMb2NhbGVQcm92aWRlci5maXJzdERheU9mV2VlayA9IDE7XG5cbiAgICAgICAgJG1kRGF0ZUxvY2FsZVByb3ZpZGVyLmZvcm1hdERhdGUgPSBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG1vbWVudChkYXRlKS5mb3JtYXQoJ0RELU1NLVlZWVknKTtcbiAgICAgICAgfTtcbiAgICAgICAgJG1kRGF0ZUxvY2FsZVByb3ZpZGVyLnBhcnNlRGF0ZSA9IGZ1bmN0aW9uIChzdHJEYXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9tZW50KHN0ckRhdGUsICdERC5NTS5ZWVlZJykudG9EYXRlKCk7XG4gICAgICAgIH07XG4gICAgfV0pO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdNYWluQ29udHJvbGxlcicsIE1haW5Db250cm9sbGVyKTtcblxuICAgIE1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzdGF0ZScsICckc2NvcGUnLCAnJHJvb3RTY29wZScsICdQcm9tcHQnLCAnJG1kU2lkZW5hdicsICckdGltZW91dCcsICckbWREaWFsb2cnXTtcblxuICAgIGZ1bmN0aW9uIE1haW5Db250cm9sbGVyKCRzdGF0ZSwgJHNjb3BlLCAkcm9vdFNjb3BlLCBQcm9tcHQsICRtZFNpZGVuYXYsICR0aW1lb3V0LCAkbWREaWFsb2cpIHtcblxuICAgICAgICAkcm9vdFNjb3BlLmFwcGxpY2F0aW9uTG9hZGVkID0gdHJ1ZTtcblxuICAgICAgICAkc2NvcGUuc2hvd1Rvb2xiYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gISRzdGF0ZS5pbmNsdWRlcygnYXV0aCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5vcGVuTWVudSA9IGZ1bmN0aW9uICgkbWRNZW51LCBldikge1xuICAgICAgICAgICAgJG1kTWVudS5vcGVuKGV2KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUudG9nZ2xlU2lkZW5hdiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRtZFNpZGVuYXYoJ3NpZGVuYXYtbGVmdCcpLnRvZ2dsZSgpO1xuICAgICAgICB9O1xuICAgIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uZmlnKHJvdXRlcik7XG5cbiAgICByb3V0ZXIuJGluamVjdCA9IFsnJHN0YXRlUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJ107XG5cbiAgICBmdW5jdGlvbiByb3V0ZXIoJHN0YXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsIFJlc2VydmF0aW9uTWFuYWdlcikge1xuXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG5cbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FwcHVpJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL21haW4ubGF5b3V0Lmh0bWw/MTUzODQ2OTk5MDU0MScsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTWFpbkNvbnRyb2xsZXInXG4gICAgICAgIH0pLnN0YXRlKCdhcHB1aS5tYWluJywge1xuICAgICAgICAgICAgdXJsOiAnLycsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvcGFnZXMvbWFpbi9wcmVzZW50Lmh0bWw/MTUzODQ2OTk5MDU0MScsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnUHJlc2VudENvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAncHJlc2VudEN0cmwnXG4gICAgICAgIH0pLnN0YXRlKCdhcHB1aS5idXknLCB7XG4gICAgICAgICAgICB1cmw6ICcvYnV5JyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9wYWdlcy9zdGVwL3N0ZXAuaHRtbD8xNTM4NDY5OTkwNTQxJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTdGVwQ29udHJvbGxlcicsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICdzdGVwQ3RybCcsXG4gICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgcmVzZXJ2YXRpb246IFsnJHJvb3RTY29wZScsICdSZXNlcnZhdGlvbk1hbmFnZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgUmVzZXJ2YXRpb25NYW5hZ2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBSZXNlcnZhdGlvbk1hbmFnZXIuZ2V0KCk7XG4gICAgICAgICAgICAgICAgfV0gfVxuICAgICAgICB9KS5zdGF0ZSgnYXBwdWkuaW5mbycsIHtcbiAgICAgICAgICAgIHVybDogJy9pbmZvJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9wYWdlcy9pbmZvL2luZm8uaHRtbD8xNTM4NDY5OTkwNTQxJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbmZvQ29udHJvbGxlcicsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICdpbmZvQ3RybCcsXG4gICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgY2F0YWxvZ3M6IFsnJHJvb3RTY29wZScsICdPcmRlck1hbmFnZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgT3JkZXJNYW5hZ2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPcmRlck1hbmFnZXIuZ2V0Q2F0YWxvZ3MoKTtcbiAgICAgICAgICAgICAgICB9XSB9XG4gICAgICAgIH0pO1xuICAgIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnYnJvd3NlcicsIGJyb3dzZXIpO1xuXG4gICAgYnJvd3Nlci4kaW5qZWN0ID0gWydEZXZpY2UnXTtcblxuICAgIGZ1bmN0aW9uIGJyb3dzZXIoRGV2aWNlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGJyb3dzZXIgPSBEZXZpY2UuaU9zU2FmYXJpKCkgPyAnc2FmYXJpLW1vYmlsZScgOiAnYnJvd3Nlcic7XG5cbiAgICAgICAgICAgICAgICBlbGVtLmFkZENsYXNzKGJyb3dzZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG4gICAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdjb21wYXJlJywgY29tcGFyZSk7XG5cbiAgICBmdW5jdGlvbiBjb21wYXJlKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgY29tcGFyZVRvOiAnPWNvbXBhcmUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSwgYXR0cnMsIG5nTW9kZWwpIHtcbiAgICAgICAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0b3JzLm5vdEVxdWFsID0gZnVuY3Rpb24gKG1vZGVsVmFsdWUsIHZpZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmdNb2RlbC4kaXNFbXB0eShtb2RlbFZhbHVlKSkgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWUgPT09IHNjb3BlLmNvbXBhcmVUby4kdmlld1ZhbHVlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2NvbXBhcmVUby4kdmlld1ZhbHVlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnc3Ryb25nUGFzc1JlcXVpcmVkJywgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIHZhciBpc1ZhbGlkID0gZnVuY3Rpb24gaXNWYWxpZChzKSB7XG4gICAgICAgICAgICByZXR1cm4gcyAmJiAvKD89LipbMC05XSkoPz0uKlthLXpdKSg/PS4qW0EtWl0pKD89XFxTKyQpLns2LH0vLnRlc3Qocyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsbSwgYXR0cnMsIG5nTW9kZWxDdHJsKSB7XG4gICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHBhcnNlcnMudW5zaGlmdChmdW5jdGlvbiAodmlld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRzZXRWYWxpZGl0eSgnc3Ryb25nUGFzcycsIGlzVmFsaWQodmlld1ZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kZm9ybWF0dGVycy51bnNoaWZ0KGZ1bmN0aW9uIChtb2RlbFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRzZXRWYWxpZGl0eSgnc3Ryb25nUGFzcycsIGlzVmFsaWQobW9kZWxWYWx1ZSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9kZWxWYWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KS5kaXJlY3RpdmUoJ3Bhc3N3b3JkTWF0Y2gnLCBbZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIHNjb3BlOiB0cnVlLFxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSwgYXR0cnMsIGNvbnRyb2wpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tlciA9IGZ1bmN0aW9uIGNoZWNrZXIoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy9nZXQgdGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBwYXNzd29yZFxuICAgICAgICAgICAgICAgICAgICB2YXIgZTEgPSBzY29wZS4kZXZhbChhdHRycy5uZ01vZGVsKTtcblxuICAgICAgICAgICAgICAgICAgICAvL2dldCB0aGUgdmFsdWUgb2YgdGhlIG90aGVyIHBhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgIHZhciBlMiA9IHNjb3BlLiRldmFsKGF0dHJzLnBhc3N3b3JkTWF0Y2gpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2wuJHZhbGlkYXRvcnMuY2hlY2sgPSBmdW5jdGlvbiAobW9kZWxWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFjb250cm9sLiRpc0VtcHR5KG1vZGVsVmFsdWUpICYmIG1vZGVsVmFsdWUgPT09IGUyO1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlMSA9PT0gZTI7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goY2hlY2tlciwgZnVuY3Rpb24gKG4pIHtcblxuICAgICAgICAgICAgICAgICAgICAvL3NldCB0aGUgZm9ybSBjb250cm9sIHRvIHZhbGlkIGlmIGJvdGhcbiAgICAgICAgICAgICAgICAgICAgLy9wYXNzd29yZHMgYXJlIHRoZSBzYW1lLCBlbHNlIGludmFsaWRcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbC4kc2V0VmFsaWRpdHkoXCJ1bmlxdWVcIiwgbik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfV0pO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdwcmV2ZW50Q2xpY2snLCBwcmV2ZW50Q2xpY2spO1xuXG4gICAgZnVuY3Rpb24gcHJldmVudENsaWNrKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7XG4gICAgICAgICAgICAgICAgJChlbGVtZW50KS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ3VwbG9hZEZpbGUnLCB1cGxvYWRGaWxlKTtcblxuICAgIHVwbG9hZEZpbGUuJGluamVjdCA9IFsnJHRpbWVvdXQnXTtcblxuICAgIGZ1bmN0aW9uIHVwbG9hZEZpbGUoJHRpbWVvdXQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtKSB7XG4gICAgICAgICAgICAgICAgZWxlbS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51cGxvYWRDdHJsLnVwbG9hZERhdGEuZmlsZSA9IGVsZW1bMF0uZmlsZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnQWxlcnQnLCBBbGVydCk7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvbiBXZSBhcmUgdXNpbmcgY3VzdG9tIGRpYWxvZyBpbnN0ZWFkIG9mIGRlZmF1bHQgYWxlcnRcbiAgICAgKiBiZWNhdXNlIGFsZXJ0IGRvZXNuJ3QgYWxsb3cgeW91IHRvIHVzZSBodG1sIGluIHRoZSBkaWFsb2cncyB0aXRsZVxuICAgICAqL1xuICAgIEFsZXJ0LiRpbmplY3QgPSBbJyRtZERpYWxvZyddO1xuXG4gICAgZnVuY3Rpb24gQWxlcnQoJG1kRGlhbG9nKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAodGl0bGUsIGh0bWxDb250ZW50KSB7XG4gICAgICAgICAgICB2YXIgb2sgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICdPayc7XG5cblxuICAgICAgICAgICAgdmFyIGFsZXJ0ID0ge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBbJzxtZC1kaWFsb2c+JywgJyAgPG1kLWRpYWxvZy1jb250ZW50IGNsYXNzPVwibWQtZGlhbG9nLWNvbnRlbnRcIiByb2xlPVwiZG9jdW1lbnRcIiB0YWJJbmRleD1cIi0xXCI+JywgJyAgICA8aDIgY2xhc3M9XCJtZC10aXRsZVwiIG5nLWJpbmQtaHRtbD1cIjo6ZGlhbG9nLnRpdGxlXCI+PC9oMj4nLCAnICAgIDxkaXYgbmctaWY9XCI6OmRpYWxvZy5tZEh0bWxDb250ZW50XCIgY2xhc3M9XCJtZC1kaWFsb2ctY29udGVudC1ib2R5XCInLCAnICAgICAgICBuZy1iaW5kLWh0bWw9XCI6OmRpYWxvZy5odG1sQ29udGVudFwiPjwvZGl2PicsICcgIDwvbWQtZGlhbG9nLWNvbnRlbnQ+JywgJyAgPG1kLWRpYWxvZy1hY3Rpb25zPicsICcgICAgPG1kLWJ1dHRvbiBuZy1jbGljaz1cImRpYWxvZy5oaWRlKClcIiBjbGFzcz1cIm1kLWFjY2VudCBtZC1jb25maXJtLWJ1dHRvblwiIHN0eWxlPVwiY29sb3I6IHdoaXRlO1wiIG1kLWF1dG9mb2N1cz1cInRydWVcIj4nLCAnICAgICAge3sgZGlhbG9nLm9rIH19JywgJyAgICA8L21kLWJ1dHRvbj4nLCAnICA8L21kLWRpYWxvZy1hY3Rpb25zPicsICc8L21kLWRpYWxvZz4nXS5qb2luKCcnKS5yZXBsYWNlKC9cXHNcXHMrL2csICcnKSxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdkaWFsb2cnLFxuICAgICAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJG1kRGlhbG9nJywgZnVuY3Rpb24gKCRtZERpYWxvZykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBkaWFsb2cgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBfcmVmID0gW3RpdGxlLCBodG1sQ29udGVudCwgb2tdO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2cudGl0bGUgPSBfcmVmWzBdO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2cuaHRtbENvbnRlbnQgPSBfcmVmWzFdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZiQgPSBfcmVmWzJdO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2cub2sgPSBfcmVmJCA9PT0gdW5kZWZpbmVkID8gb2sgOiBfcmVmJDtcblxuXG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZy5oaWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJG1kRGlhbG9nLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XVxuXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gJG1kRGlhbG9nLnNob3coYWxlcnQpO1xuICAgICAgICB9O1xuICAgIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ0NvbmZpcm0nLCBDb25maXJtKTtcblxuICAgIENvbmZpcm0uJGluamVjdCA9IFsnJG1kRGlhbG9nJ107XG5cbiAgICBmdW5jdGlvbiBDb25maXJtKCRtZERpYWxvZykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHRpdGxlKSB7XG4gICAgICAgICAgICB2YXIgdGV4dENvbnRlbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IG51bGw7XG4gICAgICAgICAgICB2YXIgb2sgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICdPayc7XG4gICAgICAgICAgICB2YXIgY2FuY2VsID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiAnQ2FuY2VsJztcblxuICAgICAgICAgICAgcmV0dXJuICRtZERpYWxvZy5zaG93KCRtZERpYWxvZy5jb25maXJtKCkudGl0bGUodGl0bGUpLnRleHRDb250ZW50KHRleHRDb250ZW50KS5vayhvaykuY2FuY2VsKGNhbmNlbCkpO1xuICAgICAgICB9O1xuICAgIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnSHR0cE1hbmFnZXInLCBIdHRwTWFuYWdlcik7XG5cbiAgICBIdHRwTWFuYWdlci4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICckc3RhdGUnLCAnJHRpbWVvdXQnLCAnJHJvb3RTY29wZScsICdBbGVydCddO1xuXG4gICAgZnVuY3Rpb24gSHR0cE1hbmFnZXIoJGh0dHAsICRxLCAkc3RhdGUsICR0aW1lb3V0LCAkcm9vdFNjb3BlLCBBbGVydCkge1xuXG4gICAgICAgIHZhciBBUEkgPSAnJztcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVxdWVzdDogcmVxdWVzdFxuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIG9uU3VjY2VzcyhyZXNwb25zZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvbkVycm9yKHJlamVjdGlvbikge1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZWplY3Rpb24pO1xuICAgICAgICAgICAgaWYgKFs0MDEsIDQwM10uaW5kZXhPZihyZWplY3Rpb24uc3RhdHVzKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdhdXRoLmxvZ2luJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZWplY3Rpb24uc3RhdHVzID09PSA0MTMpIHtcbiAgICAgICAgICAgICAgICBBbGVydCgnQXR0YWNobWVudCBpcyB0b28gbGFyZ2UnLCAnUGxlYXNlIGNob29zZSBhbm90aGVyIGF0dGFjaG1lbnQgb3IgcmVzaXplIHRoaXMgb25lJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZWplY3Rpb24uc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgICBBbGVydCgnRXJyb3InLCByZWplY3Rpb24uZGF0YS5tZXNzYWdlIHx8ICdQbGVhc2UgdHJ5IGFnYWluJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZWplY3Rpb24uc3RhdHVzID09PSA0MDEgfHwgcmVqZWN0aW9uLnN0YXR1cyA9PT0gNDAyIHx8IHJlamVjdGlvbi5zdGF0dXMgPT09IDQwMykge1xuICAgICAgICAgICAgICAgIEFsZXJ0KCdVbmF1dGhvcml6ZWQgYWNjZXNzJywgcmVqZWN0aW9uLmRhdGEubWVzc2FnZSB8fCAnVHJ5IHRvIHNpZ24gaW4gYWdhaW4sIHBsZWFzZSAuLi4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyogICAgICAgICAgICBpZiAocmVqZWN0aW9uLnN0YXR1cyA+PSA1MDApIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWplY3Rpb24uZGF0YSAmJiByZWplY3Rpb24uZGF0YS5tZXNzYWdlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGVydChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXZWJzaXRlIGVycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdGlvbi5kYXRhLm1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIEFsZXJ0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV2Vic2l0ZSBlcnJvcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXZSBhcG9sb2dpemUsIGFuIGVycm9yIG9jY3VycmVkIG9uIG91ciBzaWRlIHdoaWxlIGhhbmRsaW5nIHlvdXIgcmVxdWVzdC4gUGxlYXNlIHRyeSBhZ2FpbiBvciBjb250YWN0IHVzLidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSovXG5cbiAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlcXVlc3QoX3JlZikge1xuICAgICAgICAgICAgdmFyIF9yZWYkbWV0aG9kID0gX3JlZi5tZXRob2QsXG4gICAgICAgICAgICAgICAgbWV0aG9kID0gX3JlZiRtZXRob2QgPT09IHVuZGVmaW5lZCA/ICdnZXQnIDogX3JlZiRtZXRob2QsXG4gICAgICAgICAgICAgICAgX3JlZiR1cmwgPSBfcmVmLnVybCxcbiAgICAgICAgICAgICAgICB1cmwgPSBfcmVmJHVybCA9PT0gdW5kZWZpbmVkID8gJy8nIDogX3JlZiR1cmwsXG4gICAgICAgICAgICAgICAgX3JlZiRkYXRhID0gX3JlZi5kYXRhLFxuICAgICAgICAgICAgICAgIGRhdGEgPSBfcmVmJGRhdGEgPT09IHVuZGVmaW5lZCA/IHt9IDogX3JlZiRkYXRhLFxuICAgICAgICAgICAgICAgIF9yZWYkaGVhZGVycyA9IF9yZWYuaGVhZGVycyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzID0gX3JlZiRoZWFkZXJzID09PSB1bmRlZmluZWQgPyB7fSA6IF9yZWYkaGVhZGVycyxcbiAgICAgICAgICAgICAgICBfcmVmJHRyYW5zZm9ybVJlcXVlc3QgPSBfcmVmLnRyYW5zZm9ybVJlcXVlc3QsXG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtUmVxdWVzdCA9IF9yZWYkdHJhbnNmb3JtUmVxdWVzdCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYkdHJhbnNmb3JtUmVxdWVzdCxcbiAgICAgICAgICAgICAgICBfcmVmJHRyaWdnZXJDaXJjbGVMb2EgPSBfcmVmLnRyaWdnZXJDaXJjbGVMb2FkZXIsXG4gICAgICAgICAgICAgICAgdHJpZ2dlckNpcmNsZUxvYWRlciA9IF9yZWYkdHJpZ2dlckNpcmNsZUxvYSA9PT0gdW5kZWZpbmVkID8ge1xuICAgICAgICAgICAgICAgIHRyaWdnZXI6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG51bGxcbiAgICAgICAgICAgIH0gOiBfcmVmJHRyaWdnZXJDaXJjbGVMb2E7XG5cblxuICAgICAgICAgICAgaWYgKHRyaWdnZXJDaXJjbGVMb2FkZXIudHJpZ2dlcikge1xuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjaXJjbGVMb2FkZXJTdGFydCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHRyaWdnZXJDaXJjbGVMb2FkZXIubWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHJlcXVlc3RPYmplY3QgPSB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICAgICAgICAgICAgdXJsOiBBUEkgKyB1cmwsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobWV0aG9kLnRvTG93ZXJDYXNlKCkgPT09ICdnZXQnIHx8IG1ldGhvZC50b0xvY2FsZUxvd2VyQ2FzZSgpID09PSAnZGVsZXRlJykge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RPYmplY3QucGFyYW1zID0gZGF0YTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdE9iamVjdC5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRyYW5zZm9ybVJlcXVlc3QpIHJlcXVlc3RPYmplY3QudHJhbnNmb3JtUmVxdWVzdCA9IHRyYW5zZm9ybVJlcXVlc3Q7XG5cbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhoZWFkZXJzKS5sZW5ndGggIT09IDApIHJlcXVlc3RPYmplY3QuaGVhZGVycyA9IGhlYWRlcnM7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cChyZXF1ZXN0T2JqZWN0KS50aGVuKG9uU3VjY2Vzcywgb25FcnJvcikudGhlbihmdW5jdGlvbiAocmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgIGlmICh0cmlnZ2VyQ2lyY2xlTG9hZGVyLnRyaWdnZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjaXJjbGVMb2FkZXJTdG9wJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmU7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRyaWdnZXJDaXJjbGVMb2FkZXIudHJpZ2dlcikge1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NpcmNsZUxvYWRlclN0b3AnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlamVjdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnT3JkZXJNYW5hZ2VyJywgT3JkZXJNYW5hZ2VyKTtcblxuICAgIE9yZGVyTWFuYWdlci4kaW5qZWN0ID0gWydIdHRwTWFuYWdlciddO1xuXG4gICAgZnVuY3Rpb24gT3JkZXJNYW5hZ2VyKEh0dHBNYW5hZ2VyKSB7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlcG9ydDogcmVwb3J0LFxuICAgICAgICAgICAgZ2V0Q2F0YWxvZ3M6IGdldENhdGFsb2dzLFxuICAgICAgICAgICAgYnV5OiBidXlcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBnZXRDYXRhbG9ncygpIHtcbiAgICAgICAgICAgIHJldHVybiBIdHRwTWFuYWdlci5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgIHVybDogJy9vcmRlci9jYXRhbG9ncydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVwb3J0KGZpbG0sIGRheSwgc2Vzc2lvbikge1xuICAgICAgICAgICAgcmV0dXJuIEh0dHBNYW5hZ2VyLnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnL29yZGVyL3JlcG9ydCcsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBmaWxtSWQ6IGZpbG0uaWQsXG4gICAgICAgICAgICAgICAgICAgIGRheTogbW9tZW50KGRheSkuZm9ybWF0KCdERC5NTS5ZWVlZJyksXG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25JZDogc2Vzc2lvbiB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGJ1eSgpIHtcbiAgICAgICAgICAgIHJldHVybiBIdHRwTWFuYWdlci5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6ICcvb3JkZXIvJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdQcm9tcHQnLCBQcm9tcHQpO1xuXG4gICAgUHJvbXB0LiRpbmplY3QgPSBbJyRtZERpYWxvZyddO1xuXG4gICAgZnVuY3Rpb24gUHJvbXB0KCRtZERpYWxvZykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHRpdGxlKSB7XG4gICAgICAgICAgICB2YXIgdGV4dENvbnRlbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IG51bGw7XG4gICAgICAgICAgICB2YXIgcGxhY2Vob2xkZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICcnO1xuICAgICAgICAgICAgdmFyIG9rID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiAnT2snO1xuICAgICAgICAgICAgdmFyIGNhbmNlbCA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ICYmIGFyZ3VtZW50c1s0XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzRdIDogJ0NhbmNlbCc7XG5cbiAgICAgICAgICAgIHJldHVybiAkbWREaWFsb2cuc2hvdygkbWREaWFsb2cucHJvbXB0KCkudGl0bGUodGl0bGUpLnRleHRDb250ZW50KHRleHRDb250ZW50KS5wbGFjZWhvbGRlcihwbGFjZWhvbGRlcikucmVxdWlyZWQodHJ1ZSkub2sob2spLmNhbmNlbChjYW5jZWwpKTtcbiAgICAgICAgfTtcbiAgICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ1Jlc2VydmF0aW9uTWFuYWdlcicsIFJlc2VydmF0aW9uTWFuYWdlcik7XG5cbiAgICBSZXNlcnZhdGlvbk1hbmFnZXIuJGluamVjdCA9IFsnSHR0cE1hbmFnZXInXTtcblxuICAgIGZ1bmN0aW9uIFJlc2VydmF0aW9uTWFuYWdlcihIdHRwTWFuYWdlcikge1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRVc2VkUGxhY2U6IGdldFVzZWRQbGFjZSxcbiAgICAgICAgICAgIGdldDogZ2V0LFxuICAgICAgICAgICAgY2FuY2VsOiBjYW5jZWwsXG4gICAgICAgICAgICBzYXZlOiBzYXZlXG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgcmV0dXJuIEh0dHBNYW5hZ2VyLnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnL3Jlc2VydmF0aW9uLydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VXNlZFBsYWNlKGZpbG0sIGRheSwgc2Vzc2lvbikge1xuICAgICAgICAgICAgcmV0dXJuIEh0dHBNYW5hZ2VyLnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnL3Jlc2VydmF0aW9uL3VzZWRQbGFjZXMnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgZmlsbUlkOiBmaWxtLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXk6IG1vbWVudChkYXkpLmZvcm1hdCgnREQuTU0uWVlZWScpLFxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb24gfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XG4gICAgICAgICAgICByZXR1cm4gSHR0cE1hbmFnZXIucmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnL3Jlc2VydmF0aW9uL2RlbGV0ZSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2F2ZShyZXNlcnZhdGlvbikge1xuICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9uQ29weSA9IGFuZ3VsYXIuY29weShyZXNlcnZhdGlvbik7XG4gICAgICAgICAgICByZXNlcnZhdGlvbkNvcHkuZGF5ID0gbW9tZW50KHJlc2VydmF0aW9uQ29weS5kYXkpLmZvcm1hdCgnREQuTU0uWVlZWScpO1xuICAgICAgICAgICAgcmVzZXJ2YXRpb25Db3B5LmZpbG0gPSByZXNlcnZhdGlvbkNvcHkuZmlsbS5pZDtcbiAgICAgICAgICAgIHJldHVybiBIdHRwTWFuYWdlci5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6ICcvcmVzZXJ2YXRpb24vJyxcbiAgICAgICAgICAgICAgICBkYXRhOiByZXNlcnZhdGlvbkNvcHlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb21wb25lbnQoJ2NhcHRjaGEnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnLi9hcHAvY29tcG9uZW50cy9jYXB0Y2hhL2NhcHRjaGEuaHRtbCdcbiAgICB9KTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignQ2FwdGNoYUNvbnRyb2xsZXInLCBDYXB0Y2hhQ29udHJvbGxlcik7XG5cbiAgICBDYXB0Y2hhQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc3RhdGUnLCAnJHJvb3RTY29wZScsICckc3RhdGVQYXJhbXMnXTtcblxuICAgIGZ1bmN0aW9uIENhcHRjaGFDb250cm9sbGVyKCRzdGF0ZSwgJHJvb3RTY29wZSwgJHN0YXRlUGFyYW1zKSB7XG5cbiAgICAgICAgdmFyIGNhcHRjaGFDdHJsID0gdGhpcztcblxuICAgICAgICBjYXB0Y2hhQ3RybC5jYXB0Y2hhVXJsU3JjID0gJy9hcGkvdjEvY2FwdGNoYS5naWYnO1xuICAgICAgICBjYXB0Y2hhQ3RybC5jYXB0Y2hhVXJsID0gY2FwdGNoYUN0cmwuY2FwdGNoYVVybFNyYztcbiAgICAgICAgY2FwdGNoYUN0cmwudXBkYXRlQ2FwdGNoYSA9IHVwZGF0ZUNhcHRjaGE7XG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FwdGNoYSgpIHtcbiAgICAgICAgICAgIGNhcHRjaGFDdHJsLmNhcHRjaGFVcmwgPSBjYXB0Y2hhQ3RybC5jYXB0Y2hhVXJsU3JjICsgXCI/XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbXBvbmVudCgnbG9nbycsIHtcbiAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL2NvbXBvbmVudHMvbG9nby9sb2dvLmh0bWwnXG4gIH0pO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdJbmZvQ29udHJvbGxlcicsIEluZm9Db250cm9sbGVyKTtcblxuICAgIEluZm9Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckbG9nJywgJyRzdGF0ZScsICckdGltZW91dCcsICdjYXRhbG9ncycsICdPcmRlck1hbmFnZXInXTtcblxuICAgIGZ1bmN0aW9uIEluZm9Db250cm9sbGVyKCRzY29wZSwgJGxvZywgJHN0YXRlLCAkdGltZW91dCwgY2F0YWxvZ3MsIE9yZGVyTWFuYWdlcikge1xuXG4gICAgICAgIHZhciBpbmZvQ3RybCA9IHRoaXM7XG5cbiAgICAgICAgaWYgKGNhdGFsb2dzICYmIGNhdGFsb2dzLmRhdGEpICRzY29wZS5jYXRhbG9ncyA9IGNhdGFsb2dzLmRhdGE7XG5cbiAgICAgICAgJHNjb3BlLmZpbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmZpbG0gJiYgJHNjb3BlLnNlc3Npb24gJiYgJHNjb3BlLmRheSkgT3JkZXJNYW5hZ2VyLnJlcG9ydCgkc2NvcGUuZmlsbSwgJHNjb3BlLmRheSwgJHNjb3BlLnNlc3Npb24pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gcmVzdWx0LmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBjb2x1bW5EZWZzOiBbeyBuYW1lOiAn0JzQtdGB0YLQvicsIGZpZWxkOiAncGxhY2UubmFtZScsIGVuYWJsZVNvcnRpbmc6IGZhbHNlIH0sIHsgbmFtZTogJ9Ci0LXQu9C10YTQvtC9JywgZmllbGQ6ICdwaG9uZScsIGVuYWJsZVNvcnRpbmc6IGZhbHNlIH0sIHsgbmFtZTogJ9Ci0LjQvycsIGZpZWxkOiAndHlwZScsIGVuYWJsZVNvcnRpbmc6IGZhbHNlIH1dLFxuICAgICAgICAgICAgZGF0YTogW11cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUubWFpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwdWkubWFpbicpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5vbkNoYW5nZSA9IGZ1bmN0aW9uIChzZWFyY2gpIHt9O1xuXG4gICAgICAgICRzY29wZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5maWxtID0gbnVsbDtcbiAgICAgICAgICAgICRzY29wZS5zZXNzaW9uID0gbnVsbDtcbiAgICAgICAgICAgICRzY29wZS5kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuY2xlYXIoKTtcblxuICAgICAgICAkc2NvcGUucXVlcnkgPSBmdW5jdGlvbiAoc2VhcmNoKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VhcmNoID8gJHNjb3BlLmNhdGFsb2dzLmZpbG1zLmZpbHRlcihjcmVhdGVGaWx0ZXJGb3Ioc2VhcmNoLCAnbmFtZScpKSA6ICRzY29wZS5jYXRhbG9ncy5maWxtcztcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVGaWx0ZXJGb3IocXVlcnksIG5hbWUpIHtcbiAgICAgICAgICAgIHZhciBsb3dlcmNhc2VRdWVyeSA9IGFuZ3VsYXIubG93ZXJjYXNlKHF1ZXJ5KTtcblxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGZpbHRlckZuKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5sb3dlcmNhc2UoaXRlbVtuYW1lXSkuaW5kZXhPZihsb3dlcmNhc2VRdWVyeSkgPT09IDA7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdQcmVzZW50Q29udHJvbGxlcicsIFByZXNlbnRDb250cm9sbGVyKTtcblxuICAgIFByZXNlbnRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckbG9nJywgJyRzdGF0ZScsICckdGltZW91dCddO1xuXG4gICAgZnVuY3Rpb24gUHJlc2VudENvbnRyb2xsZXIoJHNjb3BlLCAkbG9nLCAkc3RhdGUsICR0aW1lb3V0KSB7XG5cbiAgICAgICAgdmFyIG1haW5DdHJsID0gdGhpcztcblxuICAgICAgICAkc2NvcGUuYnV5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHB1aS5idXknKTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmluZm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2FwcHVpLmluZm8nKTtcbiAgICAgICAgfTtcbiAgICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ1N0ZXBDb250cm9sbGVyJywgU3RlcENvbnRyb2xsZXIpO1xuXG4gICAgU3RlcENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRzdGF0ZScsICckcm9vdFNjb3BlJywgJ0FsZXJ0JywgJyR0aW1lb3V0JywgJ09yZGVyTWFuYWdlcicsICdSZXNlcnZhdGlvbk1hbmFnZXInLCAncmVzZXJ2YXRpb24nXTtcblxuICAgIGZ1bmN0aW9uIFN0ZXBDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkcm9vdFNjb3BlLCBBbGVydCwgJHRpbWVvdXQsIE9yZGVyTWFuYWdlciwgUmVzZXJ2YXRpb25NYW5hZ2VyLCByZXNlcnZhdGlvbikge1xuXG4gICAgICAgIHZhciBzdGVwQ3RybCA9IHRoaXM7XG5cbiAgICAgICAgLy8kc2NvcGUucmVzZXJ2YXRpb24gPSB7cGhvbmU6IG51bGwsIGZpbG06IG51bGwsIHBsYWNlczpbXX07XG4gICAgICAgICRzY29wZS5yZXNlcnZhdGlvbiA9IHtcbiAgICAgICAgICAgIGZpbG06IHsgaWQ6IDEyLCBuYW1lOiBcIlRlbXBvcmFyeSBEaWZmaWN1bHRpZXNcIiB9LFxuICAgICAgICAgICAgcGhvbmU6IFwiMTExMTFcIiwgZGF5OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgc2Vzc2lvbjogXCIzXCIsIHBsYWNlczogW11cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUudG9nZ2xlID0gZnVuY3Rpb24gKGl0ZW0sIGxpc3QpIHtcbiAgICAgICAgICAgIHZhciBpZHggPSBsaXN0LmluZGV4T2YoaXRlbSk7XG4gICAgICAgICAgICBpZiAoaWR4ID4gLTEpIGxpc3Quc3BsaWNlKGlkeCwgMSk7ZWxzZSBsaXN0LnB1c2goaXRlbSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmV4aXN0cyA9IGZ1bmN0aW9uIChpdGVtLCBsaXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gbGlzdC5pbmRleE9mKGl0ZW0pID4gLTE7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnN0ZXAgPSAxO1xuXG4gICAgICAgICRzY29wZS5lcnJNc2cgPSBcIlwiO1xuXG4gICAgICAgICRzY29wZS5zZWFyY2ggPSBcIlwiO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3Jlc2VydmF0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5yZXNlcnZhdGlvbi5maWxtICYmICRzY29wZS5yZXNlcnZhdGlvbi5kYXkgJiYgJHNjb3BlLnJlc2VydmF0aW9uLnNlc3Npb24pIHtcbiAgICAgICAgICAgICAgICBSZXNlcnZhdGlvbk1hbmFnZXIuZ2V0VXNlZFBsYWNlKCRzY29wZS5yZXNlcnZhdGlvbi5maWxtLCAkc2NvcGUucmVzZXJ2YXRpb24uZGF5LCAkc2NvcGUucmVzZXJ2YXRpb24uc2Vzc2lvbikudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhdGFsb2dzLnBsYWNlcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRpc2FibGUgPSByZXN1bHQuZGF0YS5zb21lKGZ1bmN0aW9uIChzdWJJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1Ykl0ZW0uaWQgPT09IGl0ZW0uaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5jYXRhbG9ncy5wbGFjZXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAkc2NvcGUub25DaGFuZ2UgPSBmdW5jdGlvbiAoc2VhcmNoKSB7fTtcbiAgICAgICAgJHNjb3BlLnF1ZXJ5ID0gZnVuY3Rpb24gKHNlYXJjaCkge1xuICAgICAgICAgICAgcmV0dXJuIHNlYXJjaCA/ICRzY29wZS5jYXRhbG9ncy5maWxtcy5maWx0ZXIoY3JlYXRlRmlsdGVyRm9yKHNlYXJjaCwgJ25hbWUnKSkgOiAkc2NvcGUuY2F0YWxvZ3MuZmlsbXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRmlsdGVyRm9yKHF1ZXJ5LCBuYW1lKSB7XG4gICAgICAgICAgICB2YXIgbG93ZXJjYXNlUXVlcnkgPSBhbmd1bGFyLmxvd2VyY2FzZShxdWVyeSk7XG5cbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBmaWx0ZXJGbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIubG93ZXJjYXNlKGl0ZW1bbmFtZV0pLmluZGV4T2YobG93ZXJjYXNlUXVlcnkpID09PSAwO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5jYXRhbG9ncyA9IHt9O1xuICAgICAgICBPcmRlck1hbmFnZXIuZ2V0Q2F0YWxvZ3MoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNhdGFsb2dzID0gcmVzdWx0LmRhdGE7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgZXJyb3IoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlcnJvcihlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gZXJyb3IoZSkge1xuICAgICAgICAgICAgaWYgKGUuZGF0YSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJNc2cgPSBlLmRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUudWlkID0gZS5kYXRhLnV1aWQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJNc2cgPSAn0J3QtdC40LfQstC10YHRgtC90LDRjyDQvtGI0LjQsdC60LAhJztcbiAgICAgICAgICAgICAgICAkc2NvcGUudWlkID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzY29wZS5zdGVwID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5zdGVwU3JjID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zdGVwID4gMCA/ICcvYXBwL3BhZ2VzL3N0ZXAvc3RlcCcgKyAkc2NvcGUuc3RlcCArICcuaHRtbCcgOiAnL2FwcC9wYWdlcy9zdGVwL3N0ZXBFcnJvci5odG1sJztcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgUmVzZXJ2YXRpb25NYW5hZ2VyLmNhbmNlbCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwdWkubWFpbicpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlcnJvcihlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5wYXkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBPcmRlck1hbmFnZXIuYnV5KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnN0ZXAgPSAzO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlcnJvcihlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5yZXNlcnZlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIFJlc2VydmF0aW9uTWFuYWdlci5zYXZlKCRzY29wZS5yZXNlcnZhdGlvbikudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgc2V0UmVzZXJ2YXRpb24ocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlcnJvcihlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5zYXZlZFJlc2VydmF0aW9uID0gbnVsbDtcblxuICAgICAgICB2YXIgc2V0UmVzZXJ2YXRpb24gPSBmdW5jdGlvbiBzZXRSZXNlcnZhdGlvbihyKSB7XG4gICAgICAgICAgICAkc2NvcGUuc3RlcCA9IDI7XG4gICAgICAgICAgICAkc2NvcGUuc2F2ZWRSZXNlcnZhdGlvbiA9IHI7XG4gICAgICAgICAgICAkc2NvcGUuc2F2ZWRSZXNlcnZhdGlvbi5zdHJQbGFjZXMgPSAkc2NvcGUuc2F2ZWRSZXNlcnZhdGlvbi5wbGFjZXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZTtcbiAgICAgICAgICAgIH0pLmpvaW4oKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAocmVzZXJ2YXRpb24gJiYgcmVzZXJ2YXRpb24uc3RhdHVzICYmIHJlc2VydmF0aW9uLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICBzZXRSZXNlcnZhdGlvbihyZXNlcnZhdGlvbi5kYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5tYWluID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHB1aS5tYWluJyk7XG4gICAgICAgIH07XG4gICAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2FwcGxpY2F0aW9uTG9hZGVyJywgYXBwbGljYXRpb25Mb2FkZXIpO1xuXG4gIC8vIGFwcGxpY2F0aW9uTG9hZGVyLiRpbmplY3QgPSBbXTtcbiAgZnVuY3Rpb24gYXBwbGljYXRpb25Mb2FkZXIoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICB0ZW1wbGF0ZVVybDogJ3NoYXJlZC9hcHBsaWNhdGlvbi1sb2FkZXIvYXBwbGljYXRpb24tbG9hZGVyLmh0bWwnXG4gICAgfTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdjaXJjbGVMb2FkZXInLCBjaXJjbGVMb2FkZXIpO1xuXG4gIGZ1bmN0aW9uIGNpcmNsZUxvYWRlcigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgIHJlcGxhY2U6IHRydWUsXG4gICAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL3NoYXJlZC9jaXJjbGUtbG9hZGVyL2NpcmNsZS1sb2FkZXIuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiBbJyRzY29wZScsICckdGltZW91dCcsICckaW50ZXJ2YWwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkdGltZW91dCwgJGludGVydmFsKSB7XG5cbiAgICAgICAgdmFyIGJvZHkgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSk7XG4gICAgICAgIHZhciB0b3VjaE1vdmVIYW5kbGVyID0gZnVuY3Rpb24gdG91Y2hNb3ZlSGFuZGxlcihldikge1xuICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmNpcmNsZUxvYWRlck1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAkc2NvcGUuc2hvd0NpcmNsZUxvYWRlciA9IGZhbHNlO1xuXG4gICAgICAgICRzY29wZS4kb24oJ2NpcmNsZUxvYWRlclN0YXJ0JywgZnVuY3Rpb24gKGV2LCBkYXRhKSB7XG5cbiAgICAgICAgICAvLyBQcmV2ZW50IGJvZHkgZnJvbSBzY3JvbGxpbmcgb24gbW9iaWxlIGRldmljZXMgYW5kIGRlc2t0b3BzXG4gICAgICAgICAgLy8gYm9keS5vbigndG91Y2htb3ZlJywgbnVsbCwgdG91Y2hNb3ZlSGFuZGxlcik7XG4gICAgICAgICAgLy8gYm9keS5hZGRDbGFzcygnbm8tc2Nyb2xsJyk7XG5cbiAgICAgICAgICAkc2NvcGUuY2lyY2xlTG9hZGVyTWVzc2FnZSA9IGRhdGEubWVzc2FnZTtcbiAgICAgICAgICAkc2NvcGUuc2hvd0NpcmNsZUxvYWRlciA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kb24oJ2NpcmNsZUxvYWRlclN0b3AnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJHNjb3BlLnNob3dDaXJjbGVMb2FkZXIgPSBmYWxzZTtcblxuICAgICAgICAgIC8vIGFsbG93IHNjcm9sbGluZyBiYWNrXG4gICAgICAgICAgLy8gYm9keS5vZmYoJ3RvdWNobW92ZScsIG51bGwsIHRvdWNoTW92ZUhhbmRsZXIpO1xuICAgICAgICAgIC8vIGJvZHkucmVtb3ZlQ2xhc3MoJ25vLXNjcm9sbCcpO1xuXG4gICAgICAgICAgLy8gY2lyY2xlIGxheW91dCB3aWxsIGZhZGUgYXdheSBpbiA0MDBtcywgc28gc2V0IG1lc3NhZ2UgdG8gbnVsbCBhZnRlciBsYXlvdXQgZGlzYXBwZWFyc1xuICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5jaXJjbGVMb2FkZXJNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICB9LCA0MDApO1xuICAgICAgICB9KTtcbiAgICAgIH1dXG4gICAgfTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCd0b29sYmFyJywgdG9vbGJhcik7XG5cbiAgLy8gdG9vbGJhci4kaW5qZWN0ID0gW107XG4gIGZ1bmN0aW9uIHRvb2xiYXIoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL3NoYXJlZC90b29sYmFyL3Rvb2xiYXIuaHRtbCcsXG4gICAgICByZXBsYWNlOiB0cnVlXG4gICAgfTtcbiAgfVxufSk7IiwiKCgpID0+IHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJywgW1xuICAgICAgICAnbmcnLFxuICAgICAgICAnbmdSb3V0ZScsXG4gICAgICAgICduZ01hdGVyaWFsJyxcbiAgICAgICAgJ25nTWVzc2FnZXMnLFxuICAgICAgICAnbmdBcmlhJyxcbiAgICAgICAgJ25nQW5pbWF0ZScsXG4gICAgICAgICduZ0Nvb2tpZXMnLFxuICAgICAgICAnbmdTYW5pdGl6ZScsXG4gICAgICAgICduZ0Nvb2tpZXMnLFxuICAgICAgICAnTG9jYWxTdG9yYWdlTW9kdWxlJyxcbiAgICAgICAgJ21kLmRhdGEudGFibGUnLFxuICAgICAgICAndWkucm91dGVyJyxcbiAgICAgICAgJ3VpLm1hc2snLFxuICAgICAgICAnZGF0ZXRpbWUnLFxuICAgICAgICAndGV4dEFuZ3VsYXInLFxuICAgICAgICAndWkuZ3JpZCcsXG4gICAgICAgICd1aS5ncmlkLnBhZ2luYXRpb24nLFxuICAgICAgICAndWkuZ3JpZC5zZWxlY3Rpb24nLFxuICAgICAgICAndWkuZ3JpZC5jZWxsTmF2JyxcbiAgICAgICAgJ3VpLmdyaWQuZ3JvdXBpbmcnLFxuICAgICAgICAndWkuZ3JpZC5hdXRvUmVzaXplJyxcbiAgICAgICAgJ3J6TW9kdWxlJyxcbiAgICAgICAgJ3VpLXJhbmdlU2xpZGVyJ1xuICAgIF0pLmNvbmZpZyhbJ3VpTWFzay5Db25maWdQcm92aWRlcicsIHVpTWFza0NvbmZpZ1Byb3ZpZGVyID0+IHtcbiAgICAgICAgdWlNYXNrQ29uZmlnUHJvdmlkZXIubWFza0RlZmluaXRpb25zKHsnSyc6IC9bYS16QS1aMC05XS8sICcqJzogL1thLXpBLVowLTldL30pO1xuICAgICAgICB1aU1hc2tDb25maWdQcm92aWRlci5jbGVhck9uQmx1cihmYWxzZSk7XG5cbiAgICB9XSlcbiAgICAgICAgLmNvbmZpZyhbJyRtZERhdGVMb2NhbGVQcm92aWRlcicsIGZ1bmN0aW9uICgkbWREYXRlTG9jYWxlUHJvdmlkZXIpIHtcbiAgICAgICAgICAgICRtZERhdGVMb2NhbGVQcm92aWRlci5maXJzdERheU9mV2VlayA9IDE7XG5cbiAgICAgICAgICAgICRtZERhdGVMb2NhbGVQcm92aWRlci5mb3JtYXREYXRlID0gZnVuY3Rpb24gKGRhdGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50KGRhdGUpLmZvcm1hdCgnREQtTU0tWVlZWScpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICRtZERhdGVMb2NhbGVQcm92aWRlci5wYXJzZURhdGUgPSBmdW5jdGlvbiAoc3RyRGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQoc3RyRGF0ZSAsJ0RELk1NLllZWVknKS50b0RhdGUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcblxuXG59KSgpOyIsIigoKSA9PiB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignTWFpbkNvbnRyb2xsZXInLCBNYWluQ29udHJvbGxlcik7XG5cbiAgICBNYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc3RhdGUnLCAnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnUHJvbXB0JywgJyRtZFNpZGVuYXYnLCAnJHRpbWVvdXQnLCAnJG1kRGlhbG9nJ107XG5cbiAgICBmdW5jdGlvbiBNYWluQ29udHJvbGxlcigkc3RhdGUsICRzY29wZSwgJHJvb3RTY29wZSwgIFByb21wdCwgJG1kU2lkZW5hdiwgJHRpbWVvdXQsICRtZERpYWxvZykge1xuXG4gICAgICAgICRyb290U2NvcGUuYXBwbGljYXRpb25Mb2FkZWQgPSB0cnVlO1xuXG4gICAgICAgICRzY29wZS5zaG93VG9vbGJhciA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAhJHN0YXRlLmluY2x1ZGVzKCdhdXRoJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLm9wZW5NZW51ID0gKCRtZE1lbnUsIGV2KSA9PiB7XG4gICAgICAgICAgICAkbWRNZW51Lm9wZW4oZXYpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS50b2dnbGVTaWRlbmF2ID0gKCkgPT4ge1xuICAgICAgICAgICAgJG1kU2lkZW5hdignc2lkZW5hdi1sZWZ0JykudG9nZ2xlKCk7XG4gICAgICAgIH07XG4gICAgfVxuXG59KSgpOyIsIigoKSA9PiB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uZmlnKHJvdXRlcik7XG5cbiAgICByb3V0ZXIuJGluamVjdCA9IFsnJHN0YXRlUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJ107XG5cbiAgICBmdW5jdGlvbiByb3V0ZXIoJHN0YXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsIFJlc2VydmF0aW9uTWFuYWdlcikge1xuXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcbiAgICAgICAgXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcblxuICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgLnN0YXRlKCdhcHB1aScsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvbWFpbi5sYXlvdXQuaHRtbD8xNTM4NDY5OTkwNTQxJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTWFpbkNvbnRyb2xsZXInXG4gICAgICAgICAgICB9KS5zdGF0ZSgnYXBwdWkubWFpbicsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvcGFnZXMvbWFpbi9wcmVzZW50Lmh0bWw/MTUzODQ2OTk5MDU0MScsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1ByZXNlbnRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdwcmVzZW50Q3RybCcsXG4gICAgICAgICAgICB9KS5zdGF0ZSgnYXBwdWkuYnV5Jywge1xuICAgICAgICAgICAgICAgIHVybDogJy9idXknLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9wYWdlcy9zdGVwL3N0ZXAuaHRtbD8xNTM4NDY5OTkwNTQxJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnU3RlcENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3N0ZXBDdHJsJyxcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uOiBbJyRyb290U2NvcGUnLCAnUmVzZXJ2YXRpb25NYW5hZ2VyJywgKCRyb290U2NvcGUsIFJlc2VydmF0aW9uTWFuYWdlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlc2VydmF0aW9uTWFuYWdlci5nZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfV19XG4gICAgICAgICAgICB9KS5zdGF0ZSgnYXBwdWkuaW5mbycsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvaW5mbycsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL3BhZ2VzL2luZm8vaW5mby5odG1sPzE1Mzg0Njk5OTA1NDEnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbmZvQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnaW5mb0N0cmwnLFxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgY2F0YWxvZ3M6IFsnJHJvb3RTY29wZScsICdPcmRlck1hbmFnZXInLCAoJHJvb3RTY29wZSwgT3JkZXJNYW5hZ2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT3JkZXJNYW5hZ2VyLmdldENhdGFsb2dzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1dfVxuICAgICAgICAgICAgfSk7XG5cbiAgICB9XG59KSgpOyIsIigoKSA9PiB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnYnJvd3NlcicsIGJyb3dzZXIpO1xuXG4gICAgYnJvd3Nlci4kaW5qZWN0ID0gWydEZXZpY2UnXTtcblxuICAgIGZ1bmN0aW9uIGJyb3dzZXIoRGV2aWNlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtKSB7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBicm93c2VyID0gRGV2aWNlLmlPc1NhZmFyaSgpID8gJ3NhZmFyaS1tb2JpbGUnIDogJ2Jyb3dzZXInO1xuXG4gICAgICAgICAgICAgICAgZWxlbS5hZGRDbGFzcyhicm93c2VyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIoKCkgPT4ge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2NvbXBhcmUnLCBjb21wYXJlKTtcblxuICAgIGZ1bmN0aW9uIGNvbXBhcmUoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBjb21wYXJlVG86ICc9Y29tcGFyZScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRycywgbmdNb2RlbCkge1xuICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMubm90RXF1YWwgPSBmdW5jdGlvbiAobW9kZWxWYWx1ZSwgdmlld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZ01vZGVsLiRpc0VtcHR5KG1vZGVsVmFsdWUpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZSA9PT0gc2NvcGUuY29tcGFyZVRvLiR2aWV3VmFsdWU7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnY29tcGFyZVRvLiR2aWV3VmFsdWUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRlKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKCgpID0+IHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdzdHJvbmdQYXNzUmVxdWlyZWQnLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgbGV0IGlzVmFsaWQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICAgICAgcmV0dXJuIHMgJiYgLyg/PS4qWzAtOV0pKD89LipbYS16XSkoPz0uKltBLVpdKSg/PVxcUyskKS57Nix9Ly50ZXN0KHMpXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxtLCBhdHRycywgbmdNb2RlbEN0cmwpIHtcbiAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kcGFyc2Vycy51bnNoaWZ0KGZ1bmN0aW9uICh2aWV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHNldFZhbGlkaXR5KCdzdHJvbmdQYXNzJywgaXNWYWxpZCh2aWV3VmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRmb3JtYXR0ZXJzLnVuc2hpZnQoZnVuY3Rpb24gKG1vZGVsVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHNldFZhbGlkaXR5KCdzdHJvbmdQYXNzJywgaXNWYWxpZChtb2RlbFZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbFZhbHVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pLmRpcmVjdGl2ZSgncGFzc3dvcmRNYXRjaCcsIFtmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICAgICAgc2NvcGU6IHRydWUsXG4gICAgICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSwgYXR0cnMsIGNvbnRyb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNoZWNrZXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgZmlyc3QgcGFzc3dvcmRcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlMSA9IHNjb3BlLiRldmFsKGF0dHJzLm5nTW9kZWwpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2dldCB0aGUgdmFsdWUgb2YgdGhlIG90aGVyIHBhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZTIgPSBzY29wZS4kZXZhbChhdHRycy5wYXNzd29yZE1hdGNoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC4kdmFsaWRhdG9ycy5jaGVjayA9IGZ1bmN0aW9uIChtb2RlbFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFjb250cm9sLiRpc0VtcHR5KG1vZGVsVmFsdWUpICYmIG1vZGVsVmFsdWUgPT09IGUyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUxID09PSBlMjtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGNoZWNrZXIsIGZ1bmN0aW9uIChuKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2V0IHRoZSBmb3JtIGNvbnRyb2wgdG8gdmFsaWQgaWYgYm90aFxuICAgICAgICAgICAgICAgICAgICAgICAgLy9wYXNzd29yZHMgYXJlIHRoZSBzYW1lLCBlbHNlIGludmFsaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2wuJHNldFZhbGlkaXR5KFwidW5pcXVlXCIsIG4pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG59KSgpOyIsIigoKSA9PiB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgncHJldmVudENsaWNrJywgcHJldmVudENsaWNrKTtcblxuICAgIGZ1bmN0aW9uIHByZXZlbnRDbGljaygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7XG4gICAgICAgICAgICAgICAgJChlbGVtZW50KS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIigoKSA9PiB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCd1cGxvYWRGaWxlJywgdXBsb2FkRmlsZSk7XG5cbiAgICB1cGxvYWRGaWxlLiRpbmplY3QgPSBbJyR0aW1lb3V0J107XG5cbiAgICBmdW5jdGlvbiB1cGxvYWRGaWxlKCR0aW1lb3V0KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogKHNjb3BlLCBlbGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgZWxlbS5vbignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51cGxvYWRDdHJsLnVwbG9hZERhdGEuZmlsZSA9IGVsZW1bMF0uZmlsZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKCgpID0+IHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnQWxlcnQnLCBBbGVydCk7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvbiBXZSBhcmUgdXNpbmcgY3VzdG9tIGRpYWxvZyBpbnN0ZWFkIG9mIGRlZmF1bHQgYWxlcnRcbiAgICAgKiBiZWNhdXNlIGFsZXJ0IGRvZXNuJ3QgYWxsb3cgeW91IHRvIHVzZSBodG1sIGluIHRoZSBkaWFsb2cncyB0aXRsZVxuICAgICAqL1xuICAgIEFsZXJ0LiRpbmplY3QgPSBbJyRtZERpYWxvZyddO1xuXG4gICAgZnVuY3Rpb24gQWxlcnQoJG1kRGlhbG9nKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAodGl0bGUsIGh0bWxDb250ZW50LCBvayA9ICdPaycpIHtcblxuICAgICAgICAgICAgY29uc3QgYWxlcnQgPSB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6XG4gICAgICAgICAgICAgICAgICAgIFsnPG1kLWRpYWxvZz4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJyAgPG1kLWRpYWxvZy1jb250ZW50IGNsYXNzPVwibWQtZGlhbG9nLWNvbnRlbnRcIiByb2xlPVwiZG9jdW1lbnRcIiB0YWJJbmRleD1cIi0xXCI+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPGgyIGNsYXNzPVwibWQtdGl0bGVcIiBuZy1iaW5kLWh0bWw9XCI6OmRpYWxvZy50aXRsZVwiPjwvaDI+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPGRpdiBuZy1pZj1cIjo6ZGlhbG9nLm1kSHRtbENvbnRlbnRcIiBjbGFzcz1cIm1kLWRpYWxvZy1jb250ZW50LWJvZHlcIicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICBuZy1iaW5kLWh0bWw9XCI6OmRpYWxvZy5odG1sQ29udGVudFwiPjwvZGl2PicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnICA8L21kLWRpYWxvZy1jb250ZW50PicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnICA8bWQtZGlhbG9nLWFjdGlvbnM+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPG1kLWJ1dHRvbiBuZy1jbGljaz1cImRpYWxvZy5oaWRlKClcIiBjbGFzcz1cIm1kLWFjY2VudCBtZC1jb25maXJtLWJ1dHRvblwiIHN0eWxlPVwiY29sb3I6IHdoaXRlO1wiIG1kLWF1dG9mb2N1cz1cInRydWVcIj4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIHt7IGRpYWxvZy5vayB9fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvbWQtYnV0dG9uPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnICA8L21kLWRpYWxvZy1hY3Rpb25zPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9tZC1kaWFsb2c+J1xuICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJycpLnJlcGxhY2UoL1xcc1xccysvZywgJycpLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2RpYWxvZycsXG4gICAgICAgICAgICAgICAgbXVsdGlwbGU6IHRydWUsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogWyckbWREaWFsb2cnLCBmdW5jdGlvbiAoJG1kRGlhbG9nKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IGRpYWxvZyA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICAgICAgW2RpYWxvZy50aXRsZSwgZGlhbG9nLmh0bWxDb250ZW50LCBkaWFsb2cub2sgPSBva10gPSBbdGl0bGUsIGh0bWxDb250ZW50LCBva107XG5cbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XVxuXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gJG1kRGlhbG9nLnNob3coYWxlcnQpO1xuXG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIigoKSA9PiB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ0NvbmZpcm0nLCBDb25maXJtKTtcblxuICAgIENvbmZpcm0uJGluamVjdCA9IFsnJG1kRGlhbG9nJ107XG5cbiAgICBmdW5jdGlvbiBDb25maXJtKCRtZERpYWxvZykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHRpdGxlLCB0ZXh0Q29udGVudCA9IG51bGwsIG9rID0gJ09rJywgY2FuY2VsID0gJ0NhbmNlbCcpIHtcbiAgICAgICAgICAgIHJldHVybiAkbWREaWFsb2cuc2hvdygkbWREaWFsb2cuY29uZmlybSgpXG4gICAgICAgICAgICAgICAgLnRpdGxlKHRpdGxlKVxuICAgICAgICAgICAgICAgIC50ZXh0Q29udGVudCh0ZXh0Q29udGVudClcbiAgICAgICAgICAgICAgICAub2sob2spXG4gICAgICAgICAgICAgICAgLmNhbmNlbChjYW5jZWwpXG4gICAgICAgICAgICApXG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIigoKSA9PiB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnSHR0cE1hbmFnZXInLCBIdHRwTWFuYWdlcik7XG5cbiAgICBIdHRwTWFuYWdlci4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICckc3RhdGUnLCAnJHRpbWVvdXQnLCAnJHJvb3RTY29wZScsICdBbGVydCddO1xuXG4gICAgZnVuY3Rpb24gSHR0cE1hbmFnZXIoJGh0dHAsICRxLCAkc3RhdGUsICR0aW1lb3V0LCAkcm9vdFNjb3BlLCBBbGVydCkge1xuXG4gICAgICAgIGNvbnN0IEFQSSA9ICcnO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXF1ZXN0XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gb25TdWNjZXNzKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9uRXJyb3IocmVqZWN0aW9uKSB7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlamVjdGlvbik7XG4gICAgICAgICAgICBpZiAoWzQwMSwgNDAzXS5pbmRleE9mKHJlamVjdGlvbi5zdGF0dXMpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2F1dGgubG9naW4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJlamVjdGlvbi5zdGF0dXMgPT09IDQxMykge1xuICAgICAgICAgICAgICAgIEFsZXJ0KFxuICAgICAgICAgICAgICAgICAgICAnQXR0YWNobWVudCBpcyB0b28gbGFyZ2UnLFxuICAgICAgICAgICAgICAgICAgICAnUGxlYXNlIGNob29zZSBhbm90aGVyIGF0dGFjaG1lbnQgb3IgcmVzaXplIHRoaXMgb25lJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZWplY3Rpb24uc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgICBBbGVydChcbiAgICAgICAgICAgICAgICAgICAgJ0Vycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0aW9uLmRhdGEubWVzc2FnZSB8fCAnUGxlYXNlIHRyeSBhZ2FpbidcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVqZWN0aW9uLnN0YXR1cyA9PT0gNDAxIHx8IHJlamVjdGlvbi5zdGF0dXMgPT09IDQwMiB8fCByZWplY3Rpb24uc3RhdHVzID09PSA0MDMpIHtcbiAgICAgICAgICAgICAgICBBbGVydChcbiAgICAgICAgICAgICAgICAgICAgJ1VuYXV0aG9yaXplZCBhY2Nlc3MnLFxuICAgICAgICAgICAgICAgICAgICByZWplY3Rpb24uZGF0YS5tZXNzYWdlIHx8ICdUcnkgdG8gc2lnbiBpbiBhZ2FpbiwgcGxlYXNlIC4uLidcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4vKiAgICAgICAgICAgIGlmIChyZWplY3Rpb24uc3RhdHVzID49IDUwMCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlamVjdGlvbi5kYXRhICYmIHJlamVjdGlvbi5kYXRhLm1lc3NhZ2UpXG4gICAgICAgICAgICAgICAgICAgIEFsZXJ0KFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1dlYnNpdGUgZXJyb3InLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0aW9uLmRhdGEubWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGVsc2UgQWxlcnQoXG4gICAgICAgICAgICAgICAgICAgICdXZWJzaXRlIGVycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgJ1dlIGFwb2xvZ2l6ZSwgYW4gZXJyb3Igb2NjdXJyZWQgb24gb3VyIHNpZGUgd2hpbGUgaGFuZGxpbmcgeW91ciByZXF1ZXN0LiBQbGVhc2UgdHJ5IGFnYWluIG9yIGNvbnRhY3QgdXMuJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9Ki9cblxuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZWplY3Rpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9ICdnZXQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAnLycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0ID0gbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlckNpcmNsZUxvYWRlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICB9KSB7XG5cbiAgICAgICAgICAgIGlmICh0cmlnZ2VyQ2lyY2xlTG9hZGVyLnRyaWdnZXIpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2lyY2xlTG9hZGVyU3RhcnQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB0cmlnZ2VyQ2lyY2xlTG9hZGVyLm1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHJlcXVlc3RPYmplY3QgPSB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICAgICAgICAgICAgdXJsOiBBUEkgKyB1cmwsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobWV0aG9kLnRvTG93ZXJDYXNlKCkgPT09ICdnZXQnIHx8IG1ldGhvZC50b0xvY2FsZUxvd2VyQ2FzZSgpID09PSAnZGVsZXRlJykge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RPYmplY3QucGFyYW1zID0gZGF0YTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdE9iamVjdC5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRyYW5zZm9ybVJlcXVlc3QpIHJlcXVlc3RPYmplY3QudHJhbnNmb3JtUmVxdWVzdCA9IHRyYW5zZm9ybVJlcXVlc3Q7XG5cbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhoZWFkZXJzKS5sZW5ndGggIT09IDApIHJlcXVlc3RPYmplY3QuaGVhZGVycyA9IGhlYWRlcnM7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cChyZXF1ZXN0T2JqZWN0KS50aGVuKFxuICAgICAgICAgICAgICAgIG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBvbkVycm9yXG4gICAgICAgICAgICApLnRoZW4ocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRyaWdnZXJDaXJjbGVMb2FkZXIudHJpZ2dlcikge1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NpcmNsZUxvYWRlclN0b3AnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlO1xuICAgICAgICAgICAgfSwgcmVqZWN0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHJpZ2dlckNpcmNsZUxvYWRlci50cmlnZ2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2lyY2xlTG9hZGVyU3RvcCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBudWxsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZWplY3QpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuICAgIH1cblxufSkoKTsiLCIoKCkgPT4ge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ09yZGVyTWFuYWdlcicsIE9yZGVyTWFuYWdlcik7XG5cbiAgICBPcmRlck1hbmFnZXIuJGluamVjdCA9IFsnSHR0cE1hbmFnZXInXTtcblxuICAgIGZ1bmN0aW9uIE9yZGVyTWFuYWdlcihIdHRwTWFuYWdlcikge1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXBvcnQsXG4gICAgICAgICAgICBnZXRDYXRhbG9ncyxcbiAgICAgICAgICAgIGJ1eVxuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldENhdGFsb2dzKCkge1xuICAgICAgICAgICAgcmV0dXJuIEh0dHBNYW5hZ2VyLnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnL29yZGVyL2NhdGFsb2dzJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZXBvcnQoZmlsbSwgZGF5LCBzZXNzaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gSHR0cE1hbmFnZXIucmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICB1cmw6ICcvb3JkZXIvcmVwb3J0JyxcbiAgICAgICAgICAgICAgICBkYXRhOntcbiAgICAgICAgICAgICAgICAgICAgZmlsbUlkOiBmaWxtLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXk6IG1vbWVudChkYXkpLmZvcm1hdCgnREQuTU0uWVlZWScpLFxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb259XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGJ1eSgpIHtcbiAgICAgICAgICAgIHJldHVybiBIdHRwTWFuYWdlci5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6ICcvb3JkZXIvJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cblxufSkoKTsiLCIoKCkgPT4ge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdQcm9tcHQnLCBQcm9tcHQpO1xuXG4gICAgUHJvbXB0LiRpbmplY3QgPSBbJyRtZERpYWxvZyddO1xuXG4gICAgZnVuY3Rpb24gUHJvbXB0KCRtZERpYWxvZykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRDb250ZW50ID0gbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlciA9ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gJ09rJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSAnQ2FuY2VsJykge1xuICAgICAgICAgICAgcmV0dXJuICRtZERpYWxvZy5zaG93KCRtZERpYWxvZy5wcm9tcHQoKVxuICAgICAgICAgICAgICAgIC50aXRsZSh0aXRsZSlcbiAgICAgICAgICAgICAgICAudGV4dENvbnRlbnQodGV4dENvbnRlbnQpXG4gICAgICAgICAgICAgICAgLnBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyKVxuICAgICAgICAgICAgICAgIC5yZXF1aXJlZCh0cnVlKVxuICAgICAgICAgICAgICAgIC5vayhvaylcbiAgICAgICAgICAgICAgICAuY2FuY2VsKGNhbmNlbClcbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKCgpID0+IHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdSZXNlcnZhdGlvbk1hbmFnZXInLCBSZXNlcnZhdGlvbk1hbmFnZXIpO1xuXG4gICAgUmVzZXJ2YXRpb25NYW5hZ2VyLiRpbmplY3QgPSBbJ0h0dHBNYW5hZ2VyJ107XG5cbiAgICBmdW5jdGlvbiBSZXNlcnZhdGlvbk1hbmFnZXIoSHR0cE1hbmFnZXIpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0VXNlZFBsYWNlLFxuICAgICAgICAgICAgZ2V0LFxuICAgICAgICAgICAgY2FuY2VsLFxuICAgICAgICAgICAgc2F2ZVxuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgIHJldHVybiBIdHRwTWFuYWdlci5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgIHVybDogJy9yZXNlcnZhdGlvbi8nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzZWRQbGFjZShmaWxtLCBkYXksIHNlc3Npb24pIHtcbiAgICAgICAgICAgIHJldHVybiBIdHRwTWFuYWdlci5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgIHVybDogJy9yZXNlcnZhdGlvbi91c2VkUGxhY2VzJyxcbiAgICAgICAgICAgICAgICBkYXRhOntcbiAgICAgICAgICAgICAgICAgICAgZmlsbUlkOiBmaWxtLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXk6IG1vbWVudChkYXkpLmZvcm1hdCgnREQuTU0uWVlZWScpLFxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb259XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcbiAgICAgICAgICAgIHJldHVybiBIdHRwTWFuYWdlci5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6ICcvcmVzZXJ2YXRpb24vZGVsZXRlJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzYXZlKHJlc2VydmF0aW9uKSB7XG4gICAgICAgICAgICBsZXQgcmVzZXJ2YXRpb25Db3B5ID0gYW5ndWxhci5jb3B5KHJlc2VydmF0aW9uKTtcbiAgICAgICAgICAgIHJlc2VydmF0aW9uQ29weS5kYXkgPSBtb21lbnQocmVzZXJ2YXRpb25Db3B5LmRheSkuZm9ybWF0KCdERC5NTS5ZWVlZJyk7XG4gICAgICAgICAgICByZXNlcnZhdGlvbkNvcHkuZmlsbSA9IHJlc2VydmF0aW9uQ29weS5maWxtLmlkO1xuICAgICAgICAgICAgcmV0dXJuIEh0dHBNYW5hZ2VyLnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogJy9yZXNlcnZhdGlvbi8nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHJlc2VydmF0aW9uQ29weVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cblxufSkoKTsiLCIoKCkgPT4ge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbXBvbmVudCgnY2FwdGNoYScsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2FwcC9jb21wb25lbnRzL2NhcHRjaGEvY2FwdGNoYS5odG1sJyxcbiAgICB9KVxuXG59KSgpO1xuIiwiKCgpID0+IHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdDYXB0Y2hhQ29udHJvbGxlcicsIENhcHRjaGFDb250cm9sbGVyKTtcblxuICAgIENhcHRjaGFDb250cm9sbGVyLiRpbmplY3QgPSBbICckc3RhdGUnLCAnJHJvb3RTY29wZScsICckc3RhdGVQYXJhbXMnXTtcblxuICAgIGZ1bmN0aW9uIENhcHRjaGFDb250cm9sbGVyKCRzdGF0ZSwgJHJvb3RTY29wZSwgJHN0YXRlUGFyYW1zKSB7XG5cbiAgICAgICAgbGV0IGNhcHRjaGFDdHJsID0gdGhpcztcblxuICAgICAgICBjYXB0Y2hhQ3RybC5jYXB0Y2hhVXJsU3JjID0gJy9hcGkvdjEvY2FwdGNoYS5naWYnO1xuICAgICAgICBjYXB0Y2hhQ3RybC5jYXB0Y2hhVXJsID0gY2FwdGNoYUN0cmwuY2FwdGNoYVVybFNyYztcbiAgICAgICAgY2FwdGNoYUN0cmwudXBkYXRlQ2FwdGNoYSA9IHVwZGF0ZUNhcHRjaGE7XG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FwdGNoYSgpIHtcbiAgICAgICAgICAgIGNhcHRjaGFDdHJsLmNhcHRjaGFVcmwgPSBjYXB0Y2hhQ3RybC5jYXB0Y2hhVXJsU3JjICsgXCI/XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpO1xuIiwiKCgpID0+IHtcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29tcG9uZW50KCdsb2dvJywge1xuICAgIHRlbXBsYXRlVXJsOiAnLi9hcHAvY29tcG9uZW50cy9sb2dvL2xvZ28uaHRtbCcsXG4gIH0pXG5cbn0pKCk7IiwiKCgpID0+IHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdJbmZvQ29udHJvbGxlcicsIEluZm9Db250cm9sbGVyKTtcblxuICAgIEluZm9Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICAnJGxvZycsICckc3RhdGUnLCAnJHRpbWVvdXQnLCAnY2F0YWxvZ3MnLCAnT3JkZXJNYW5hZ2VyJ107XG5cbiAgICBmdW5jdGlvbiBJbmZvQ29udHJvbGxlcigkc2NvcGUsICAkbG9nLCAkc3RhdGUsICR0aW1lb3V0LCBjYXRhbG9ncywgT3JkZXJNYW5hZ2VyKSB7XG5cbiAgICAgICAgbGV0IGluZm9DdHJsID0gdGhpcztcblxuICAgICAgICBpZihjYXRhbG9ncyAmJiAgY2F0YWxvZ3MuZGF0YSkgJHNjb3BlLmNhdGFsb2dzID0gY2F0YWxvZ3MuZGF0YTtcblxuICAgICAgICAkc2NvcGUuZmluZCA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmKCRzY29wZS5maWxtICYmICRzY29wZS5zZXNzaW9uICYmICRzY29wZS5kYXkpXG4gICAgICAgICAgICAgICAgT3JkZXJNYW5hZ2VyLnJlcG9ydCgkc2NvcGUuZmlsbSwgJHNjb3BlLmRheSwgJHNjb3BlLnNlc3Npb24pLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmRhdGEgPSByZXN1bHQuZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBjb2x1bW5EZWZzOiBbXG4gICAgICAgICAgICAgICAgeyBuYW1lOifQnNC10YHRgtC+JywgZmllbGQ6ICdwbGFjZS5uYW1lJywgZW5hYmxlU29ydGluZzogZmFsc2UgfSxcbiAgICAgICAgICAgICAgICB7IG5hbWU6J9Ci0LXQu9C10YTQvtC9JywgZmllbGQ6ICdwaG9uZScsIGVuYWJsZVNvcnRpbmc6IGZhbHNlIH0sXG4gICAgICAgICAgICAgICAgeyBuYW1lOifQotC40L8nLCBmaWVsZDogJ3R5cGUnLCBlbmFibGVTb3J0aW5nOiBmYWxzZX1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBkYXRhOiBbXVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5tYWluID0gKCkgPT4ge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHB1aS5tYWluJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLm9uQ2hhbmdlID0gKHNlYXJjaCkgPT4ge1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5jbGVhciA9ICgpID0+IHtcbiAgICAgICAgICAgICRzY29wZS5maWxtID0gbnVsbDtcbiAgICAgICAgICAgICRzY29wZS5zZXNzaW9uID0gbnVsbDtcbiAgICAgICAgICAgICRzY29wZS5kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuY2xlYXIoKTtcblxuICAgICAgICAkc2NvcGUucXVlcnkgPSAoc2VhcmNoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gc2VhcmNoID8gJHNjb3BlLmNhdGFsb2dzLmZpbG1zLmZpbHRlcihjcmVhdGVGaWx0ZXJGb3Ioc2VhcmNoLCAnbmFtZScpKSA6ICRzY29wZS5jYXRhbG9ncy5maWxtcztcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVGaWx0ZXJGb3IocXVlcnksIG5hbWUpIHtcbiAgICAgICAgICAgIGxldCBsb3dlcmNhc2VRdWVyeSA9IGFuZ3VsYXIubG93ZXJjYXNlKHF1ZXJ5KTtcblxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGZpbHRlckZuKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGFuZ3VsYXIubG93ZXJjYXNlKGl0ZW1bbmFtZV0pLmluZGV4T2YobG93ZXJjYXNlUXVlcnkpID09PSAwKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiLCIoKCkgPT4ge1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ1ByZXNlbnRDb250cm9sbGVyJywgUHJlc2VudENvbnRyb2xsZXIpO1xuXG4gICAgUHJlc2VudENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgICckbG9nJywgJyRzdGF0ZScsICckdGltZW91dCddO1xuXG4gICAgZnVuY3Rpb24gUHJlc2VudENvbnRyb2xsZXIoJHNjb3BlLCAgJGxvZywgJHN0YXRlLCAkdGltZW91dCkge1xuXG4gICAgICAgIGxldCBtYWluQ3RybCA9IHRoaXM7XG5cbiAgICAgICAgJHNjb3BlLmJ1eSA9ICgpID0+IHtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwdWkuYnV5Jyk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5pbmZvID0gKCkgPT4ge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHB1aS5pbmZvJyk7XG4gICAgICAgIH07XG5cbiAgICB9XG5cbn0pKCk7IiwiKCgpID0+IHtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdTdGVwQ29udHJvbGxlcicsIFN0ZXBDb250cm9sbGVyKTtcblxuICAgIFN0ZXBDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckc3RhdGUnLCAnJHJvb3RTY29wZScsICdBbGVydCcsICckdGltZW91dCcsICdPcmRlck1hbmFnZXInLCAnUmVzZXJ2YXRpb25NYW5hZ2VyJywgJ3Jlc2VydmF0aW9uJ107XG5cbiAgICBmdW5jdGlvbiBTdGVwQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZSwgJHJvb3RTY29wZSwgQWxlcnQsICR0aW1lb3V0LCBPcmRlck1hbmFnZXIsIFJlc2VydmF0aW9uTWFuYWdlciwgcmVzZXJ2YXRpb24pIHtcblxuICAgICAgICBsZXQgc3RlcEN0cmwgPSB0aGlzO1xuXG4gICAgICAgIC8vJHNjb3BlLnJlc2VydmF0aW9uID0ge3Bob25lOiBudWxsLCBmaWxtOiBudWxsLCBwbGFjZXM6W119O1xuICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb24gPSB7XG4gICAgICAgICAgICBmaWxtOiB7aWQ6IDEyLCBuYW1lOiBcIlRlbXBvcmFyeSBEaWZmaWN1bHRpZXNcIn0sXG4gICAgICAgICAgICBwaG9uZTogXCIxMTExMVwiLCBkYXk6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBzZXNzaW9uOiBcIjNcIiwgcGxhY2VzOiBbXVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS50b2dnbGUgPSBmdW5jdGlvbiAoaXRlbSwgbGlzdCkge1xuICAgICAgICAgICAgbGV0IGlkeCA9IGxpc3QuaW5kZXhPZihpdGVtKTtcbiAgICAgICAgICAgIGlmIChpZHggPiAtMSkgbGlzdC5zcGxpY2UoaWR4LCAxKTsgZWxzZSBsaXN0LnB1c2goaXRlbSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmV4aXN0cyA9IGZ1bmN0aW9uIChpdGVtLCBsaXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gbGlzdC5pbmRleE9mKGl0ZW0pID4gLTE7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnN0ZXAgPSAxO1xuXG4gICAgICAgICRzY29wZS5lcnJNc2cgPSBcIlwiO1xuXG4gICAgICAgICRzY29wZS5zZWFyY2ggPSBcIlwiO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3Jlc2VydmF0aW9uJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZigkc2NvcGUucmVzZXJ2YXRpb24uZmlsbSAmJiAkc2NvcGUucmVzZXJ2YXRpb24uZGF5ICYmICRzY29wZS5yZXNlcnZhdGlvbi5zZXNzaW9uKXtcbiAgICAgICAgICAgICAgICBSZXNlcnZhdGlvbk1hbmFnZXIuZ2V0VXNlZFBsYWNlKCRzY29wZS5yZXNlcnZhdGlvbi5maWxtLCAkc2NvcGUucmVzZXJ2YXRpb24uZGF5LCAkc2NvcGUucmVzZXJ2YXRpb24uc2Vzc2lvbilcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT57XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2F0YWxvZ3MucGxhY2VzLmZvckVhY2goKGl0ZW0pID0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlzYWJsZSA9IHJlc3VsdC5kYXRhLnNvbWUoc3ViSXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdWJJdGVtLmlkID09PSBpdGVtLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuY2F0YWxvZ3MucGxhY2VzKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgJHNjb3BlLm9uQ2hhbmdlID0gKHNlYXJjaCkgPT4ge1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUucXVlcnkgPSAoc2VhcmNoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gc2VhcmNoID8gJHNjb3BlLmNhdGFsb2dzLmZpbG1zLmZpbHRlcihjcmVhdGVGaWx0ZXJGb3Ioc2VhcmNoLCAnbmFtZScpKSA6ICRzY29wZS5jYXRhbG9ncy5maWxtcztcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVGaWx0ZXJGb3IocXVlcnksIG5hbWUpIHtcbiAgICAgICAgICAgIGxldCBsb3dlcmNhc2VRdWVyeSA9IGFuZ3VsYXIubG93ZXJjYXNlKHF1ZXJ5KTtcblxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGZpbHRlckZuKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGFuZ3VsYXIubG93ZXJjYXNlKGl0ZW1bbmFtZV0pLmluZGV4T2YobG93ZXJjYXNlUXVlcnkpID09PSAwKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUuY2F0YWxvZ3MgPSB7fTtcbiAgICAgICAgT3JkZXJNYW5hZ2VyLmdldENhdGFsb2dzKCkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2F0YWxvZ3MgPSByZXN1bHQuZGF0YTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBlcnJvcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgKGUpID0+IHtcbiAgICAgICAgICAgIGVycm9yKGUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiBlcnJvcihlKSB7XG4gICAgICAgICAgICBpZihlLmRhdGEpe1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJNc2cgPSBlLmRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUudWlkID0gZS5kYXRhLnV1aWQ7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyTXNnID0gJ9Cd0LXQuNC30LLQtdGB0YLQvdCw0Y8g0L7RiNC40LHQutCwISc7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnVpZCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUuc3RlcCA9IDA7XG5cbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5zdGVwU3JjID0gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zdGVwID4gMCA/ICcvYXBwL3BhZ2VzL3N0ZXAvc3RlcCcgKyAkc2NvcGUuc3RlcCArICcuaHRtbCcgOiAnL2FwcC9wYWdlcy9zdGVwL3N0ZXBFcnJvci5odG1sJztcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuY2FuY2VsID0gKCkgPT4ge1xuICAgICAgICAgICAgUmVzZXJ2YXRpb25NYW5hZ2VyLmNhbmNlbCgpLnRoZW4oKCkgPT4geyRzdGF0ZS5nbygnYXBwdWkubWFpbicpO30sIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZXJyb3IoZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUucGF5ID0gKCkgPT4ge1xuICAgICAgICAgICAgT3JkZXJNYW5hZ2VyLmJ1eSgpLnRoZW4oKHJlc3VsdCkgPT57XG4gICAgICAgICAgICAgICAgJHNjb3BlLnN0ZXAgPSAzO1xuICAgICAgICAgICAgfSwgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlcnJvcihlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5yZXNlcnZlZCA9ICgpID0+IHtcbiAgICAgICAgICAgIFJlc2VydmF0aW9uTWFuYWdlci5zYXZlKCRzY29wZS5yZXNlcnZhdGlvbikudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIHNldFJlc2VydmF0aW9uKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgIH0sIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZXJyb3IoZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuc2F2ZWRSZXNlcnZhdGlvbiA9IG51bGw7XG5cbiAgICAgICAgbGV0IHNldFJlc2VydmF0aW9uID0gKHIpID0+IHtcbiAgICAgICAgICAgICRzY29wZS5zdGVwID0gMjtcbiAgICAgICAgICAgICRzY29wZS5zYXZlZFJlc2VydmF0aW9uID0gcjtcbiAgICAgICAgICAgICRzY29wZS5zYXZlZFJlc2VydmF0aW9uLnN0clBsYWNlcyA9ICRzY29wZS5zYXZlZFJlc2VydmF0aW9uLnBsYWNlcy5tYXAoaXRlbSA9PiBpdGVtLm5hbWUpLmpvaW4oKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAocmVzZXJ2YXRpb24gJiYgcmVzZXJ2YXRpb24uc3RhdHVzICYmIHJlc2VydmF0aW9uLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICBzZXRSZXNlcnZhdGlvbihyZXNlcnZhdGlvbi5kYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5tYWluID0gKCkgPT4ge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHB1aS5tYWluJyk7XG4gICAgICAgIH07XG5cbiAgICB9XG5cbn0pKCk7IiwiKCgpID0+IHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2FwcGxpY2F0aW9uTG9hZGVyJywgYXBwbGljYXRpb25Mb2FkZXIpO1xuXG4gIC8vIGFwcGxpY2F0aW9uTG9hZGVyLiRpbmplY3QgPSBbXTtcbiAgZnVuY3Rpb24gYXBwbGljYXRpb25Mb2FkZXIoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICB0ZW1wbGF0ZVVybDogJ3NoYXJlZC9hcHBsaWNhdGlvbi1sb2FkZXIvYXBwbGljYXRpb24tbG9hZGVyLmh0bWwnXG4gICAgfVxuICB9XG59KSgpOyIsIigoKSA9PiB7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgLmRpcmVjdGl2ZSgnY2lyY2xlTG9hZGVyJywgY2lyY2xlTG9hZGVyKTtcblxuICBmdW5jdGlvbiBjaXJjbGVMb2FkZXIoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICByZXBsYWNlOiB0cnVlLFxuICAgICAgdGVtcGxhdGVVcmw6ICcuL2FwcC9zaGFyZWQvY2lyY2xlLWxvYWRlci9jaXJjbGUtbG9hZGVyLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogWyckc2NvcGUnLCAnJHRpbWVvdXQnLCAnJGludGVydmFsJywgKCRzY29wZSwgJHRpbWVvdXQsICRpbnRlcnZhbCkgPT4ge1xuXG4gICAgICAgIGNvbnN0IGJvZHkgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSk7XG4gICAgICAgIGNvbnN0IHRvdWNoTW92ZUhhbmRsZXIgPSBldiA9PiB7XG4gICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuY2lyY2xlTG9hZGVyTWVzc2FnZSA9IG51bGw7XG4gICAgICAgICRzY29wZS5zaG93Q2lyY2xlTG9hZGVyID0gZmFsc2U7XG5cbiAgICAgICAgJHNjb3BlLiRvbignY2lyY2xlTG9hZGVyU3RhcnQnLCAoZXYsIGRhdGEpID0+IHtcblxuICAgICAgICAgIC8vIFByZXZlbnQgYm9keSBmcm9tIHNjcm9sbGluZyBvbiBtb2JpbGUgZGV2aWNlcyBhbmQgZGVza3RvcHNcbiAgICAgICAgICAvLyBib2R5Lm9uKCd0b3VjaG1vdmUnLCBudWxsLCB0b3VjaE1vdmVIYW5kbGVyKTtcbiAgICAgICAgICAvLyBib2R5LmFkZENsYXNzKCduby1zY3JvbGwnKTtcblxuICAgICAgICAgICRzY29wZS5jaXJjbGVMb2FkZXJNZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICRzY29wZS5zaG93Q2lyY2xlTG9hZGVyID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiRvbignY2lyY2xlTG9hZGVyU3RvcCcsICgpID0+IHtcbiAgICAgICAgICAkc2NvcGUuc2hvd0NpcmNsZUxvYWRlciA9IGZhbHNlO1xuXG4gICAgICAgICAgLy8gYWxsb3cgc2Nyb2xsaW5nIGJhY2tcbiAgICAgICAgICAvLyBib2R5Lm9mZigndG91Y2htb3ZlJywgbnVsbCwgdG91Y2hNb3ZlSGFuZGxlcik7XG4gICAgICAgICAgLy8gYm9keS5yZW1vdmVDbGFzcygnbm8tc2Nyb2xsJyk7XG5cbiAgICAgICAgICAvLyBjaXJjbGUgbGF5b3V0IHdpbGwgZmFkZSBhd2F5IGluIDQwMG1zLCBzbyBzZXQgbWVzc2FnZSB0byBudWxsIGFmdGVyIGxheW91dCBkaXNhcHBlYXJzXG4gICAgICAgICAgJHRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgJHNjb3BlLmNpcmNsZUxvYWRlck1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgIH0sIDQwMCk7XG5cbiAgICAgICAgfSlcblxuICAgICAgfV1cbiAgICB9XG4gIH1cblxufSkoKTsiXX0=
